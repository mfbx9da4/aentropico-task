<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="width=device-width" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">

<title>Embedding Angular in the physical world | ng-newsletter</title>

<meta name="author" content="Ari Lerner">
<meta name="description" content="This week, we explore how to use Angular with the Arduino to provide an interface to embedded applications. We'll work step by step through how to build an Angular app with the Arduino. angularjs angularjs tutorial angular">
<meta name="keywords" content="angularjs getting started with angularjs angular tutorial angularjs tutorial arduino arduino and angular angular arduino arduinoular angular angularjs arduino arduino angular arduino angularjs angularjs angularjs tutorial angular realtime firebase angularfire">

<meta name="msvalidate.01" content="BE7DA3BEF0F11153F6E4B5585C12DB20" />
<meta property="og:type" content="website" />
<meta property="og:title" content="ng-newsletter" />
<meta property="og:url" content="http://ng-newsletter.com" />
<meta property="og:image" content="http://ng-newsletter.com/img/" />
<meta property="og:description" content="This week, we explore how to use Angular with the Arduino to provide an interface to embedded applications. We'll work step by step through how to build an Angular app with the Arduino." />

<meta name="twitter:card" value="summary" />
<meta name="twitter:creator" value="@auser" />
<meta name="twitter:title" value="ng-newsletter" />
<meta name="twitter:description" value="This week, we explore how to use Angular with the Arduino to provide an interface to embedded applications. We'll work step by step through how to build an Angular app with the Arduino." />
<meta name="twitter:image" value="http://ng-newsletter.com/img/" />

<link rel="alternate" type="application/rss+xml" href="feed.rss" title="Sitewide RSS 2.0 Feed">
<link rel="alternate" type="application/atom+xml" href="atom.xml" title="Sitewide ATOM Feed">
<link rel="alternate" type="application/atom+json" href="atom.json" title="Sitewide JSON Feed">

<link href="/favicon.ico" rel="icon" type="image/ico" />
<link href="/css/site.css" media="screen" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Roboto:400italic,700italic,400,700|Open+Sans:r,i,b,bi|Bitter:r,i,b" media="screen" rel="stylesheet" type="text/css" />
<script src="/js/vendor/custom.modernizr.js"></script>
<script src="/js/vendor/d3.v3.min.js"></script>
<script src="/js/vendor/angular/angular.min.js"></script>
<script src="/js/vendor/angular-route/angular-route.min.js"></script>
<script src="/js/vendor/angular-animate.min.js"></script>
<script src="/js/vendor/angular-translate.min.js"></script>
<script src="/js/vendor/angular-cookies/angular-cookies.min.js"></script>


</head>
<body>

    
    <div id="header">
  <div id="topNav">
    <nav class="top-bar">
      <ul class="title-area">
        <li class="name">
          <h1><a href="/">ng-newsletter</a></h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
      </ul>

      <section class="top-bar-section">
        <ul class="right">
      		<li><a href="/posts">Articles</a></li>
          <li><a href="/advent2013/">25 days of Angular</a></li>
          <li><a href="/books">Books</a></li>
          <li><a href="/sponsor">Sponsorship</a></li>
        </ul>
      </section>
    </nav>
  </div>
  <div class="headerContent">
  </div>
</div>

    <div class="container">
      <div id="article">
        <article class="post">
          <header>
            <h1 class="mega">Embedding Angular in the physical world</h1>
          </header>
          
          <h3>How to prototype your $3.2 billion dollar business on Angular in 20 minutes</h3>

<blockquote>
<p>Today&rsquo;s article is based upon the ngConf talk presented January 2014. See the video at the <a href="#video">end of this article</a></p>
</blockquote>

<p>We&rsquo;re flexing our imagination and extending the reach of our Angular application deep into hardware. In this post, we&rsquo;re going to be looking at C++ code, the built-in language we need to use to program the Arduino. Although we will discuss how each component is built in C++, this article is not a C++ tutorial.</p>

<p><img src="/images/arduino/app.png" style="float: right; padding: 10px; margin: 10px; max-width: 400px; width: 400px;" alt="Completed app" /></p>

<p>We&rsquo;re using a fantastic open-source hardware platform: the Arduino. It is a single-board microcontroller intended to make the application of interactive objects or environments more accessible. The hardware consists of an open-source hardware board designed specifically to allow uploading and reprogramming of the chip without a chip programmer. </p>

<p>In essence, the Arduino is the ultimate prototyping hardware interface.</p>

<p>The source code for this project is available in its entirety on GitHub at <a href="http://d.pr/1Ncy">https://github.com/fullstackio/ng-diuno</a>.</p>

<h3>Why not a plug computer or the Raspberry Pi?</h3>

<p>Although the Raspberry Pi and other small form-factor computers are incredible tiny computers, oftentimes, their power is too much for an embedded application. For instance, powering a watch with a Raspberry Pi is likely to cause the watch to run out of power within a few hours. Additionally, strapping a Raspberry Pi to our wrists is likely to be uncomfortable.</p>

<p>For products like wearables, it&rsquo;s often a better choice to use custom-built hardware. At the prototype stage, it can become cumbersome and expensive just to get a physical prototype ready to test.</p>

<p>The Arduino gives us a great environment to build and prototype hardware that will eventually become products of their own. Alongside the Arduino, Angular itself is a fantastic prototyping tool, as well, as we can rapidly achieve impressive results in our web applications. The combination of these two technologies gives us the ability to rapidly craft a hardware-based product with incredibly functional visual interaction in little time. </p>

<blockquote>
<p>Angular is suitable for both prototype and production applications.</p>
</blockquote>

<h3>Understanding hardware</h3>

<p>When doing any work with hardware, we need to understand a few fundamentals about how to interact with the physical components.</p>

<p>At its root, the Arduino is an open-source hardware platform that enables us to easily write software to prototype components in an easily manageable way. Typical Arduinos include a Programmable Integrated Circuit (PIC) that can be easily programmed and re-programmed through USB. Most Arduinos can be powered through USB, wall sockets, or batteries.</p>

<p>All Arduino boards include <em>sockets</em> where we can place different components, LEDs, potentiometers, LCD screens, sensors, etc. These <em>sockets</em> are referred to as <strong>pins</strong>. There are several different types of pins available on an Arduino: There are digital pins that allow us to apply a static amount of current; there are analog pins that allow us to apply a dynamic amount of current; and there are special pins. For more information about the different pin types, check out the <a href="http://arduino.cc/">Arduino documentation</a></p>

<p>With these pins, there are only a few actions we&rsquo;re interested in managing:</p>

<ul>
<li>Turning pins HIGH/LOW</li>
<li>Applying a variable amount of current</li>
<li>Measuring voltage across a pin</li>
</ul>

<p>Turning a pin <strong>HIGH</strong> typically means we&rsquo;re applying voltage to the pin, whereas turning a pin <strong>LOW</strong> typically means we&rsquo;re removing voltage from the pin. Due to how electricity works, changing the state of the pin can change how our circuits behave. For instance, if we place an LED between the ground and a digital pin, when current is not allowed through the digital pin (i.e., the pin is said to be in a <strong>LOW</strong> state), the LED will not light up; however, when current is applied to the pin, electricity will <em>want</em> to flow through the LED to the ground.</p>

<h3>What we&rsquo;re building</h3>

<p>We&rsquo;re going to demonstrate how to build a prototype remotely controlled temperature monitor (like the <a href="https://nest.com/">NEST</a>) using inexpensive and open-source hardware. The total cost of our prototype project is about $85.50 (without trying very hard to find more inexpensive hardware).</p>

<p>In today&rsquo;s project, we&rsquo;re not going to dive into actually changing the temperature in a room, as the scope is focused on getting Angular and the Arduino to play well together.</p>

<h3>The video demo</h3>

<iframe width="420" height="315" src="//www.youtube.com/embed/-rDZk40Wn1w" frameborder="0" allowfullscreen></iframe>

<blockquote>
<p>If you are interested in further information, feel free to email us at: <a href="http://www.cloudflare.com/email-protection#1d686e5d7b6871716e697c7e76337472"><span class="__cf_email__" data-cfemail="087d7b486e7d64647b7c696b63266167">[email&nbsp;protected]</span><script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l,b=document.getElementsByTagName("script");l=b[b.length-1].previousSibling;a=l.getAttribute('data-cfemail');if(a){s='';r=parseInt(a.substr(0,2),16);for(j=2;a.length-j;j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}s=document.createTextNode(s);l.parentNode.replaceChild(s,l);}}catch(e){}})();
/* ]]> */
</script></a> with any questions.</p>
</blockquote>

<p><img src="/images/arduino/connected.jpg" /></p>

<h3>Materials</h3>

<p>In order to build our temperature sensor prototype, we&rsquo;ll need to gather the following components:</p>

<ul>
<li><a href="http://arduino.cc/">Arduino</a></li>
<li><a href="http://www.amazon.com/RioRand-Upgraded-Ethernet-Arduino-Duemilanove/dp/B00EU7447Y/ref=sr_1_2?ie=UTF8&amp;amp;qid=1390262512&amp;amp;sr=8-2&amp;amp;keywords=arduino+ethernet+shield">Arduino Ethernet shield</a> OR <a href="http://www.amazon.com/Adafruit-Breakout-Onboard-Ceramic-Antenna/dp/B00H232MUE/ref=pd_sim_sbs_e_1">Adafruit Wifi Breakout board</a></li>
<li><a href="http://www.amazon.com/365buying-DS18B20-Temperature-Sensor-Waterproof/dp/B008HODWBU/ref=sr_1_2?ie=UTF8&amp;amp;qid=1390261462&amp;amp;sr=8-2&amp;amp;keywords=DS18S20">DS18S20 Temperature sensor</a></li>
<li><a href="http://www.amazon.com/E-Projects-4-7k-Resistors-Watt-Pieces/dp/B00B5RCX6Q/ref=sr_1_2?ie=UTF8&amp;amp;qid=1390261492&amp;amp;sr=8-2&amp;amp;keywords=4.7k+resistor">4.7K ohm resistor</a></li>
<li><a href="http://www.amazon.com/Round-Ultra-Bright-8000-Assortment/dp/B00FB3DFH6/ref=sr_1_20?s=electronics&amp;amp;ie=UTF8&amp;amp;qid=1390261674&amp;amp;sr=1-20&amp;amp;keywords=red+bright+LED">red LED</a></li>
<li><a href="http://www.amazon.com/Super-Bright-Blue-3000-Pcs/dp/B007XBI1KK/ref=pd_sim_sbs_pc_9">blue LED</a></li>
</ul>

<p>We&rsquo;ve assembled our shopping list on Amazon if you want to follow along with the equipment we&rsquo;re using <a href="http://d.pr/XacU">here</a>.</p>

<blockquote>
<p>For a full image of our schematic, check out the <a href="#schematic">#schematic</a> later in the article.</p>
</blockquote>

<h3>Designing our system</h3>

<p>Our system will require several components to be able to deliver the application from the Arduino:</p>

<ol>
<li>An HTTP server on the Arduino</li>
<li>A way to deliver the Angular app</li>
<li>A method for communicating to the Angular app from the Arduino</li>
<li>A method for communicating to the Arduino from the Angular app</li>
</ol>

<p>In building our system, we&rsquo;ll need to be able to communicate between the Arduino and the web browser. From the Arduino, we&rsquo;ll need to deliver the Angular app to the browser requesting the Angular app. Additionally, we&rsquo;ll need to be able to send statuses of pins through to the Angular app.</p>

<p>From the opposite side, we&rsquo;ll need to be able to modify the pin states on the Arduino from the Angular app. When we click a button, we&rsquo;ll want the Arduino to respond. In this article, we&rsquo;ll explore how to manage both of these types of interactions using Angular.</p>

<blockquote>
<p>Although we&rsquo;re using Angular in this article, many of the techniques presented here to interact with the Arduino can be applied by any JavaScript framework.</p>
</blockquote>

<h3>Designing the Angular delivery</h3>

<p>In order to deliver an Angular app through the Arduino, we&rsquo;ll need to be able to send the app to the browser. We have several different options of how to deliver the source of our apps. We can either:</p>

<ul>
<li>Write the entire app inline with our C code</li>
<li>Send files from an SD card (if available on the Arduino/boards)</li>
<li>Send content from a remote web server</li>
</ul>

<p>It&rsquo;s impractical to inline our entire Angular application with the Arduino source code, as it will quickly fill up the entire programmable space (for instance, the Arduino UNO board has only 32kb of space for its control code). This approach only makes sense when delivering tiny JavaScript applications. We can rule this out as an approach to building our application.</p>

<p>Since we&rsquo;re prototyping the application, we want to easily be able to modify the code and the running system as we write it. This requirement makes writing to an SD card less than ideal for writing our Angular app in prototyping phase.</p>

<p>When we&rsquo;re ready to deliver the final system, we can store the entire application on an SD card if the system calls for it. For instance, if we have a product that we don&rsquo;t want to expose to the entire web, we can store all necessary content locally on the SD card and be completely disconnected from the Internet.</p>

<p>Since we&rsquo;re prototyping our temperature sensor, we will allow the browser to fetch its dependencies like normal, rather than store them entirely on the Arduino. That is, we&rsquo;ll send HTML back to the browser that tells it to retrieve its dependencies off-site.</p>

<h3>Schematic</h3>

<p>The full schematic of our completed prototype will look like the following:</p>

<div id="schematic" name="schematic"></div>

<p><img src="/images/arduino/schematic.png" /></p>

<h3>Getting started with the Arduino</h3>

<p>Once we have an Arduino available, we&rsquo;ll need to have a way to communicate to the Arduino over USB. We&rsquo;ll use the Arduino IDE to apply software to the PIC. The Arduino IDE is freely available online through the Arduino homepage <a href="http://arduino.cc/">here</a>. Any time that we refer to <em>C</em> code, we&rsquo;re talking about the code that we&rsquo;ll write in our Arduino IDE.</p>

<p>Let&rsquo;s test our our Arduino to get started. Inside our Arduino IDE, copy and paste the following code:</p>
<pre class="highlight c"><span class="kt">int</span> <span class="n">led</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">led</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>
</pre>
<blockquote>
<p>This is the sample app called <em>Blink</em> that&rsquo;s distributed with the Arduino IDE.</p>
</blockquote>

<p>To test our Arduino, we&rsquo;ll place an LED with the long side of the LED in the ground pin and the short side in the pin labeled <em>13</em>.</p>

<p><img src="/images/arduino/arduino.png" /></p>

<h4>Click the <em>upload</em> button.</h4>

<p>The IDE will compile the code first. If there is nothing wrong with the code then it will upload it to the Arduino, connected by USB. If the Arduino successfully receives the new sketch, then we should see the LED connected in pin 13 blink on and off, waiting a second between each blink.</p>

<p>If the software doesn&rsquo;t compile, check to make sure there are no stray marks in the code. Oftentimes, the problem is that we simply forgot a <code>;</code> or added one too many <code>}</code>.</p>

<p>If the sketch doesn&rsquo;t upload to the board, then check to make sure the cable is connected properly. Check to make sure the device shows up on the computer. We might need to change the programmer or the serial board (both of these can be found in the <code>Tools</code> menu bar item). Check to make sure the Serial port is set to the Arduino device (if on a Linux or OSX machine, these will show up as /dev/tty.xxxx where the xxxx is a name that indicates the a port).</p>

<blockquote>
<p>Using the Arduino Uno, we use the programmer as <strong>AVR ISP.</strong></p>
</blockquote>

<p>Let&rsquo;s create a new sketch that we&rsquo;ll use to create our Arduino app. Add the following base content to our sketch:</p>
<pre class="highlight c"><span class="cp">#include &lt;SPI.h&gt;
#include &lt;Flash.h&gt;
#include &lt;OneWire.h&gt;

#define DEBUG 1
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Our setup code goes here
</span><span class="cp">#if DEBUG
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="cp">#endif
</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Our loop code goes here
</span><span class="p">}</span>

</pre>
<blockquote>
<p>We&rsquo;ve included a <code>DEBUG</code> flag in our code so that, as we&rsquo;re developing our Arduino app, we can compile the code with or without debugging statements easily.</p>

<p>When we want to include debugging statements, we&rsquo;ll set the <code>DEBUG</code> flag to <code>1</code>, as in above. When we&rsquo;re ready to <em>deploy</em> the application, we can turn the <code>DEBUG</code> flag to <code>0</code> and reduce the size and latency of the application in practice.</p>
</blockquote>

<h3>Connecting to the net</h3>

<p>In order to actually get our Arduino on the net, we have to use either an ethernet shield (or breakout board) or a wifi shield (or breakout board). When using the ethernet shield, we need to be connected to a router that&rsquo;s accessible by a computer.</p>

<h4>Ethernet shield</h4>

<p>When using the ethernet shield, the code to get connected online is incredibly simple:</p>
<pre class="highlight c"><span class="c1">// Set the MAC address
</span><span class="k">static</span> <span class="n">uint8_t</span> <span class="n">mac</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xDD</span><span class="p">,</span><span class="mh">0xAD</span><span class="p">,</span><span class="mh">0xBE</span><span class="p">,</span><span class="mh">0xAF</span><span class="p">,</span><span class="mh">0xFD</span><span class="p">,</span><span class="mh">0xED</span> <span class="p">};</span>

<span class="c1">// Set an IP for our network
</span><span class="n">byte</span> <span class="n">ip</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">67</span> <span class="p">};</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="cp">#if DEBUG
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Setting up the Ethernet card...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
<span class="cp">#endif
</span>  <span class="n">Ethernet</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">ip</span><span class="p">);</span>
  <span class="c1">// ...
</span><span class="p">}</span>
</pre>
<p>Provided we&rsquo;ve created an IP that&rsquo;s available on the network, when we boot our Arduino it will be accessible by the IP we&rsquo;ve set above.</p>

<p>We can also use DHCP to allow the network to give us an available IP. The only change we need to take care of in the code is to pass the <code>Ethernet.begin()</code> function only a single argument of the MAC address.</p>
<pre class="highlight c"><span class="c1">// Set the MAC address
</span><span class="k">static</span> <span class="n">uint8_t</span> <span class="n">mac</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xDD</span><span class="p">,</span><span class="mh">0xAD</span><span class="p">,</span><span class="mh">0xBE</span><span class="p">,</span><span class="mh">0xAF</span><span class="p">,</span><span class="mh">0xFD</span><span class="p">,</span><span class="mh">0xED</span> <span class="p">};</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...
</span><span class="cp">#if DEBUG
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Setting up the Ethernet card...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">));</span>
<span class="cp">#endif
</span>  <span class="n">Ethernet</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">mac</span><span class="p">);</span>
  <span class="c1">// ...
</span><span class="p">}</span>
</pre>
<p>Note that using DHCP instead of setting a static IP will increase the size of the sketch dramatically. It&rsquo;s usually better to set the IP as a static IP on the network to save on this space.</p>

<h4>WiFi shield</h4>

<p><img src="/images/arduino/ethernet.jpg" /></p>

<p>If we want to use a wifi shield or breakout board instead of the ethernet shield, we&rsquo;ll need to be aware of the size of our sketch. When using the <a href="http://www.adafruit.com/products/1469">Adafruit CC3000</a>, we&rsquo;ll need to include the Adafruit library.</p>

<p>Grab the library at <a href="http://learn.adafruit.com/adafruit-cc3000-wifi/cc3000-library-software">http://learn.adafruit.com/adafruit-cc3000-wifi/cc3000-library-software</a> and download it. The library can be installed as we described above.</p>

<p>The CC3000 is fairly heavyweight, in terms of the compiled library size, so when using it, we&rsquo;ll need to make sure we have enough space to run our actual application.</p>

<p>To set up the CC3000 to fetch an IP from the network, the above code stretches out to:</p>
<pre class="highlight c"><span class="cp">#define ADAFRUIT_CC3000_IRQ   3
#define ADAFRUIT_CC3000_VBAT  5
#define ADAFRUIT_CC3000_CS    10
</span>
<span class="n">Adafruit_CC3000</span> <span class="n">cc3000</span> <span class="o">=</span>
  <span class="n">Adafruit_CC3000</span><span class="p">(</span><span class="n">ADAFRUIT_CC3000_CS</span><span class="p">,</span>
                  <span class="n">ADAFRUIT_CC3000_IRQ</span><span class="p">,</span>
                  <span class="n">ADAFRUIT_CC3000_VBAT</span><span class="p">,</span>
                  <span class="n">SPI_CLOCK_DIV2</span><span class="p">);</span>

<span class="cp">#define WLAN_SSID       &quot;myWireless&quot;
#define WLAN_PASS       &quot;p4ssw0rd&quot;
// Security can be WLAN_SEC_UNSEC, WLAN_SEC_WEP, WLAN_SEC_WPA or WLAN_SEC_WPA2
#define WLAN_SECURITY   WLAN_SEC_WPA2
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cc3000</span><span class="p">.</span><span class="n">begin</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Unable to initialise the CC3000! Check your wiring?&quot;</span><span class="p">));</span>
      <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="cm">/* Delete any old connection data on the module */</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Deleting old connection profiles&quot;</span><span class="p">));</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cc3000</span><span class="p">.</span><span class="n">deleteProfiles</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Failed!&quot;</span><span class="p">));</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">char</span> <span class="o">*</span><span class="n">ssid</span> <span class="o">=</span> <span class="n">WLAN_SSID</span><span class="p">;</span>             <span class="c1">// Max 32 chars 
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Attempting to connect to &quot;</span><span class="p">));</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ssid</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cc3000</span><span class="p">.</span><span class="n">connectToAP</span><span class="p">(</span><span class="n">WLAN_SSID</span><span class="p">,</span> <span class="n">WLAN_PASS</span><span class="p">,</span> <span class="n">WLAN_SECURITY</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Failed!&quot;</span><span class="p">));</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Connected!&quot;</span><span class="p">));</span>

  <span class="c1">// Wait for DHCP to complete 
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;Request DHCP&quot;</span><span class="p">));</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">cc3000</span><span class="p">.</span><span class="n">checkDHCP</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="c1">// ToDo: Insert a DHCP timeout!
</span>  <span class="p">}</span>
<span class="p">}</span>
</pre>
<p><img src="/images/arduino/wifi.jpg" /></p>

<p>For the duration of this article, we&rsquo;ll be using an ethernet shield to connect to the network.</p>

<h3>Getting started with the Angular app</h3>

<p>As we progress through our application, we&rsquo;ll want to implement the Angular components and the Arduino (hardware) side. We&rsquo;re going to be using the <code>yeoman</code> toolchain to write our Angular app.</p>

<blockquote>
<p>Although we can use any toolchain to write our app, we do need a server running to fetch the Angular app. It&rsquo;s possible to write the app using a tool like Lineman or even just using a basic file server.</p>
</blockquote>

<p>To install Yeoman, ensure that Node and NPM are installed. If they are not, grab the installation package at: <a href="http://nodejs.org">nodejs.org</a>. Once you have them, install Yeoman like so:</p>
<pre class="highlight shell"><span class="gp">$ </span>npm install -g yo
</pre>
<p>Next, we&rsquo;ll need to include the Angular generator, a generator that was written to create a professional Angular app.</p>
<pre class="highlight shell"><span class="gp">$ </span>npm install -g generator-angular
</pre>
<p>We&rsquo;ll use this generator to create our Angular app. Let&rsquo;s create a directory where we&rsquo;ll store our Angular app, then run the generator inside the directory, as follows:</p>
<pre class="highlight shell"><span class="gp">$ </span>mkdir app <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$_</span>
<span class="gp">$ </span>yo angular myTemp
</pre>
<p>The generator will ask a few questions, then generate the application. For our purposes, the defaults are fine.</p>

<p>Once the generator is complete, we&rsquo;ll run the Angular app using the command: <code>grunt serve</code>. This command will launch the server and open our web browser. Note the address that the browser opens as: <code>http://localhost:9000</code>. We&rsquo;ll use this URL in a bit.</p>

<h3>Running the HTTP server</h3>

<p>Now that both of our systems are ready to go, we can start implementing our Arduino web server. Writing a full-blown HTTP server in c++ can be pretty complex. Luckily, the Arduino team has done a fantastic job of packaging up relevant TCP/UDP socket libraries in the built-in <code>Ethernet.h</code> library.</p>

<p>The simplest web server using the <code>Ethernet.h</code> library might look something like:</p>
<pre class="highlight c"><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// listen for incoming clients
</span>  <span class="n">EthernetClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="n">available</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\n'</span> <span class="o">&amp;&amp;</span> <span class="n">currentLineIsBlank</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">client</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;HTTP/1.1 200 OK&quot;</span><span class="p">);</span>
          <span class="n">client</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Content-Type: text/html&quot;</span><span class="p">);</span>
          <span class="n">client</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Connection: close&quot;</span><span class="p">);</span>
          <span class="n">client</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
          <span class="n">client</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hi from the Arduino&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">currentLineIsBlank</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">'\r'</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">currentLineIsBlank</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">client</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>When trying to map HTTP request methods and URL routes, our code can become complex and ugly VERY quickly.</p>

<p>Rather than implement the web server ourselves, we&rsquo;ll use a library, called <a href="https://github.com/ovidiucp/TinyWebServer">TinyWebServer</a>, that abstracts a lot of the ugliness away.</p>

<p>The <code>TinyWebServer</code> library allows us to create a map of request URLs and HTTP methods to point to C functions to handle the request. For instance, when writing our index route, (the base route that responds when we request the root: <code>/</code>), we&rsquo;ll map the URL to the <code>/</code> route as a GET request and point it to a function we&rsquo;ll write in C.</p>

<h4>Implementing TinyWebServer</h4>

<p>To start using the <code>TinyWebServer</code> library, we need to install it in our Arduino IDE. Luckily, installation is easy. Download the <code>TinyWebServer</code> from <a href="https://github.com/ovidiucp/TinyWebServer">https://github.com/ovidiucp/TinyWebServer</a>. In our Arduino IDE, we&rsquo;ll click on the <code>Sketch</code> menu item and click <code>Import Library</code>-><code>Add Library</code>. We&rsquo;ll need to find the library on our system and select it within the new dialog box.</p>

<p>We&rsquo;ll also need to include the <code>Ethernet.h</code> library along with the <code>TinyWebServer</code> library. In the Arduino sketch that we created previously, let&rsquo;s add the lines that create the mapping to our index route:</p>
<pre class="highlight c"><span class="cp">#include &lt;SPI.h&gt;
#include &lt;Flash.h&gt;
#include &lt;TinyWebServer.h&gt;

#define DEBUG 1
</span>
<span class="c1">// index handler
</span><span class="n">boolean</span> <span class="nf">index_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// We need to end the list of handlers
// with a NULL object
</span><span class="n">TinyWebServer</span><span class="o">::</span><span class="n">PathHandler</span> <span class="n">handlers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">TinyWebServer</span><span class="o">::</span><span class="n">GET</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">index_handler</span> <span class="p">},</span>
  <span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="c1">// Headers to retrieve. This list needs
// to be closed with a NULL object
</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">headers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">NULL</span><span class="p">};</span>

<span class="c1">// Create the TinyWebServer handler
</span><span class="n">TinyWebServer</span> <span class="n">web</span> <span class="o">=</span> <span class="n">TinyWebServer</span><span class="p">(</span><span class="n">handlers</span><span class="p">,</span> <span class="n">headers</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Our setup code goes here
</span><span class="cp">#if DEBUG
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="cp">#endif
</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Process the next request in the loop
</span>  <span class="n">web</span><span class="p">.</span><span class="n">process</span><span class="p">();</span>
<span class="p">}</span>

</pre>
<p>With this updated code, we have our <em>map</em> of routes and HTTP method requests. When a request comes in, the TinyWebServer handler we created, called <code>web</code>, will process the request on the next loop cycle.</p>

<p>If there is a request, the <code>web.process()</code> function (in the <code>loop()</code> function above) will block until the request is finished being handled.</p>

<blockquote>
<p>Note that the handlers and headers lists need to end with a <strong>NULL</strong> object.</p>
</blockquote>

<p>Every function that we define as a handler for a route will take a single parameter: the address of the <code>TinyWebServer</code> request object created through the client HTTP request. They are expected to return a boolean value that defines whether or not the request should be closed. For every one of our requests, we&rsquo;ll return <code>true</code>, which tells TinyWebServer to close the connection.</p>

<p>We can return <code>false</code> if we want to manage closing the connection manually. For instance, if we wanted to keep the connection around for handling <a href="http://www.w3schools.com/html/html5_serversentevents.asp">Server sent events</a>, for example, we would return <code>false</code> and manage the client connection through the raw <code>Ethernet</code> Client object.</p>

<h4>Why headers[]</h4>

<p>The TinyWebServer library is written to be efficient and do only as much work is needed to handle request mapping. Thus, in order to get any headers from our request, we need to tell our instance what headers we are interested in keeping around so that it only does enough work to handle those headers.</p>

<h4>Sending back HTML</h4>

<p>When a GET request comes in at the <code>/</code> route, the web process will call the <code>index_handler</code> function. From inside this function, we have access to the TinyWebServer object. This <code>TinyWebServer</code> object allows us to interact with the raw HTTP request at a high level.</p>

<p>To send data back from the HTTP request, we can use the <code>print</code> method on the <code>web_server</code> TinyWebServer object. Since we are sending HTML back to the client, we can simply write it directly to the response object.</p>

<p>To send back a simple, blank HTML page with a title, we can write it out using the following code:</p>
<pre class="highlight c"><span class="n">boolean</span> <span class="nf">index_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;html&gt;&lt;head&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;title&gt;Temperature sensor&lt;/title&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;/head&gt;&lt;body&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">));</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<blockquote>
<p>We are using the <code>F()</code> function to tell the Arduino compiler to store the constant strings in flash memory, rather than in SRAM. Since there are orders of magnitude more space available in flash memory (otherwise known as the program space) on the Arduino, it&rsquo;s usually a good practice to get in the habit of storing constant strings in Flash.</p>

<p>One limitation when using flash memory: We cannot manipulate variables in the flash memory, as it&rsquo;s considered static memory.</p>
</blockquote>

<p>When we compile and run this sketch on the Arduino and connect to it in our web browser, we&rsquo;ll get a blank page with a title of &ldquo;Temperature sensor.&rdquo;</p>

<h3>Getting Angular involved</h3>

<p>Up until this point, we haven&rsquo;t touched Angular. Let&rsquo;s get Angular involved. Since we have control of the HTML that is passed back from the Arduino, we can use this flow to pass in an external script to be loaded by the browser. We&rsquo;ll use a single script that will dynamically place the Angular app on the page.</p>

<p>First, we need to tell the C program where our external host that is hosting our Angular app. Since we&rsquo;re developing our application alongside the Arduino, we can set this to be local to our host network.</p>

<blockquote>
<p>In production, we&rsquo;ll want to deploy our code to an external web server and use a DNS name to fetch the script.</p>

<p>It&rsquo;s also possible to use a DNS name to develop locally by changing our router settings to point a DNS lookup to our local server.</p>
</blockquote>

<p>We&rsquo;ll use this host to inject a <code>&lt;script&gt;</code> tag in our HTML in the index router:</p>
<pre class="highlight c"><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">HOST</span> <span class="o">=</span> <span class="s">&quot;10.0.1.2:9000&quot;</span><span class="p">;</span>
<span class="c1">// ...
</span><span class="n">boolean</span> <span class="nf">index_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Temperature sensor&lt;/title&gt;&lt;/head&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;body&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;script id=</span><span class="se">\&quot;</span><span class="s">appscript</span><span class="se">\&quot;</span><span class="s"> src=</span><span class="se">\&quot;</span><span class="s">http://&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">HOST</span><span class="p">);</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;/scripts/scripts.js</span><span class="se">\&quot;</span><span class="s">&gt;&lt;/script&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">));</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>When we load our browser page with our updated index handler, the browser will attempt to load the HOST + <code>/scripts/scripts.js</code> file. In order to prototype locally, we&rsquo;ll need to launch our Yeoman server using the <code>grunt serve</code> command and fetch the new page from the Arduino.</p>

<h3>Embedding Angular</h3>

<p>Now that we have control over the script that the DOM will load, how do we get Angular on the page?</p>

<p>We&rsquo;re going to load everything dynamically onto the page. This method is akin to how Facebook provides its JavaScript SDK API to third-party sites. We&rsquo;ll add our styles and scripts using the <code>scripts.js</code> file.</p>

<p>We&rsquo;ll need to use this script to inject all of our dependencies. We&rsquo;ll also add the <code>ng-app</code> directive to the <code>&lt;body&gt;</code> tag on the fly and set up a directive that will encapsulate our entire view.</p>

<p>In order to fetch the external scripts on our page, we&rsquo;ll need to request the external libraries from the same host domain. We&rsquo;ll use a regular expression to extract the host from our original script on the page:</p>
<pre class="highlight javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">scriptTag</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'script'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">scriptTag</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^http[s]?\:\/\/([^\/?#]+)(?:[\/?#]|$)/i</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">body</span>  <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'body'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">head</span>  <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'head'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">})();</span>
</pre>
<p>Next let&rsquo;s create two helper functions that will help us place a <code>&lt;link&gt;</code> tag and a <code>&lt;script&gt;</code> tag on our page.</p>
<pre class="highlight javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// script tag
</span>
  <span class="kd">var</span> <span class="nx">createLinkTag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'link'</span><span class="p">);</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'rel'</span><span class="p">,</span> <span class="s1">'stylesheet'</span><span class="p">);</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'text/css'</span><span class="p">);</span>
    <span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">,</span> <span class="nx">host</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">src</span><span class="p">);</span>
    <span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">createScriptTag</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">async</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">script</span>   <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'script'</span><span class="p">);</span>
    <span class="nx">script</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'src'</span><span class="p">,</span> <span class="nx">host</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">src</span><span class="p">);</span>
    <span class="nx">script</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="nx">async</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
  <span class="p">};</span>
</pre>
<p>With these two functions, we can place our files on the page. First, we&rsquo;ll set up our link tags on the head element (using the above function) and then our Angular dependencies. Finally, we&rsquo;ll load our app-specific JavaScript files:</p>
<pre class="highlight javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// ...
</span>
  <span class="c1">// Create the link styles
</span>  <span class="nx">createLinkTag</span><span class="p">(</span><span class="s1">'bower_components/sass-bootstrap/dist/css/bootstrap.css'</span><span class="p">);</span>
  <span class="nx">createLinkTag</span><span class="p">(</span><span class="s1">'styles/main.css'</span><span class="p">);</span>

  <span class="c1">// Setup the angular dependencies
</span>  <span class="nx">createScriptTag</span><span class="p">(</span><span class="s1">'bower_components/angular/angular.js'</span><span class="p">);</span>
  <span class="nx">createScriptTag</span><span class="p">(</span><span class="s1">'bower_components/d3/d3.min.js'</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'scripts/modules/arduino.js'</span><span class="p">,</span>
    <span class="s1">'scripts/app.js'</span><span class="p">,</span>
    <span class="s1">'scripts/services/d3.js'</span><span class="p">,</span>
    <span class="s1">'scripts/directives/mainview.js'</span><span class="p">,</span>
    <span class="s1">'scripts/directives/temperatureGauge.js'</span>
  <span class="p">];</span>

  <span class="c1">// Load the app files
</span>  <span class="nx">arr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span> <span class="p">{</span> <span class="nx">createScriptTag</span><span class="p">(</span><span class="nx">src</span><span class="p">);</span> <span class="p">});</span>
  <span class="c1">// ...
</span><span class="p">})();</span>
</pre>
<p>Lastly, we&rsquo;ll need to dynamically assign the <code>ng-app</code> directive to the body element and attach the main-view directive:</p>
<pre class="highlight javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ...
</span>
  <span class="nx">body</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'ng-app'</span><span class="p">,</span> <span class="s1">'myApp'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">app</span>   <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">main</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>
  <span class="nx">main</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'main-view'</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">main</span><span class="p">);</span>
  <span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">app</span><span class="p">);</span>
<span class="p">})();</span>
</pre>
<p>When our browser fetches this script, we&rsquo;ll have a fully featured running Angular app.</p>

<p><img src="/images/arduino/app.png" /></p>

<p>We have a bit of cleanup that we need to do to ensure that the views can be read from the hosting server and are able to communicate to the hosted server.</p>

<p>First, we need to set the <code>$sce</code>, or the Strict Contextual Escaping service, to be able to load from the hosting URL. Without this step, we&rsquo;ll get a very confusing error saying that the Angular app does not have the proper permissions to load the templates.</p>
<pre class="highlight javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[])</span>
<span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$sceDelegateProvider</span><span class="p">,</span> <span class="nx">HOSTED_URL</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$sceDelegateProvider</span><span class="p">.</span><span class="nx">resourceUrlWhitelist</span><span class="p">([</span>
    <span class="s1">'self'</span><span class="p">,</span>
    <span class="nx">HOSTED_URL</span><span class="p">()</span> <span class="o">+</span> <span class="s1">'**'</span>
  <span class="p">]);</span>
<span class="p">});</span>
</pre>
<p>Secondly, we&rsquo;ll need to inject the loaded URL from the <code>&lt;script&gt;</code> tag. We can do this a number of ways, but using a <code>constant</code> will ensure that the value is always set at the start of the Angular app:</p>
<pre class="highlight javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[</span>
  <span class="s1">'fsArduino'</span>
<span class="p">])</span>
<span class="p">.</span><span class="nx">constant</span><span class="p">(</span><span class="s1">'HOSTED_URL'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">scriptTag</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'appscript'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">scriptTag</span><span class="p">.</span><span class="nx">src</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^http[s]?\:\/\/([^\/?#]+)(?:[#]?|$)/i</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Default, just in case
</span>    <span class="k">return</span> <span class="s1">'http://localhost:9000'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})</span>
<span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$sceDelegateProvider</span><span class="p">,</span> <span class="nx">HOSTED_URL</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$sceDelegateProvider</span><span class="p">.</span><span class="nx">resourceUrlWhitelist</span><span class="p">([</span>
    <span class="s1">'self'</span><span class="p">,</span>
    <span class="nx">HOSTED_URL</span><span class="p">()</span> <span class="o">+</span> <span class="s1">'**'</span>
  <span class="p">]);</span>
<span class="p">});</span>
</pre>
<h3>Interacting with the Arduino</h3>

<p>Now that we have Angular loading through the Arduino HTTP server, we can start to interact with the board through our Angular app. Before we can actually start to interact with the Arduino from the Angular app, we&rsquo;ll need to know the Arduino&rsquo;s IP.</p>

<p>Since we know the IP from the Arduino code, we can use the same approach to inject the IP from inside the index handler using a <code>&lt;script&gt;</code> tag:</p>
<pre class="highlight c"><span class="n">byte</span> <span class="n">ip</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">32</span> <span class="p">};</span>
<span class="c1">// ...
</span><span class="n">boolean</span> <span class="nf">index_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Temperature sensor&lt;/title&gt;&lt;/head&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;body&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;script&gt;window.ip=</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">ip_to_str</span><span class="p">(</span><span class="n">ip</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\&quot;</span><span class="s">&lt;/script&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;script id=</span><span class="se">\&quot;</span><span class="s">appscript</span><span class="se">\&quot;</span><span class="s"> src=</span><span class="se">\&quot;</span><span class="s">http://&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">HOST</span><span class="p">);</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;/scripts/scripts.js</span><span class="se">\&quot;</span><span class="s">&gt;&lt;/script&gt;&quot;</span><span class="p">));</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">F</span><span class="p">(</span><span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">));</span>
  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ...
</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="nf">ip_to_str</span><span class="p">(</span><span class="k">const</span> <span class="n">uint8_t</span><span class="o">*</span> <span class="n">ipAddr</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
  <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d.%d.%d.%d</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
      <span class="n">ipAddr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ipAddr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ipAddr</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ipAddr</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
  <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>With the Arduino IP located on the <code>window</code> object, we can reach it from inside the Angular app.</p>

<h3>The Arduino module</h3>

<p>We&rsquo;ll use a module called <code>fsArduino</code> to contain the interactions between our Angular app and the Arduino. Inside this module, we&rsquo;ll set up bindings that allow us to interact with the Arduino without needing to know the underlying data structure of how we communicate with it.</p>
<pre class="highlight javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'fsArduino'</span><span class="p">,</span> <span class="p">[])</span>
<span class="p">.</span><span class="nx">constant</span><span class="p">(</span><span class="s1">'ARDUINO_URL'</span><span class="p">,</span> <span class="s1">'http://'</span> <span class="o">+</span> <span class="nb">window</span><span class="p">.</span><span class="nx">ip</span><span class="p">)</span>
<span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'Arduino'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ARDUINO_URL</span><span class="p">,</span> <span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">getPins</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// Define getPins
</span>    <span class="p">},</span>
    <span class="na">setPins</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pins</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Define setPins
</span>    <span class="p">}</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">service</span><span class="p">;</span>
<span class="p">});</span>
</pre>
<p>We&rsquo;ll use this Arduino service to get status from, and to set pins on, the Arduino. Note: We&rsquo;re using the <code>constant()</code> of <code>ARDUINO_URL</code> to store the Arduino&rsquo;s IP. </p>

<h3>Getting pin status</h3>

<p>We can get the status of a pin using the service method <code>getPins()</code>, as we&rsquo;ve defined above. Since we&rsquo;re interacting with the Arduino over HTTP, we can simply use the <code>$http</code> service to make a standard HTTP call to our Arduino. </p>
<pre class="highlight javascript"><span class="c1">// ...
</span><span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">getPins</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$http</span><span class="p">({</span>
      <span class="na">method</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
      <span class="na">url</span><span class="p">:</span> <span class="nx">ARDUINO_URL</span> <span class="o">+</span> <span class="s1">'/pins'</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="c1">// ...
</span></pre>
<p>Back on the Arduino side, we need to create a route that will receive this request and respond with the status of the pins.</p>

<p>Using the <code>TinyWebServer</code> library handlers array, we can set up our mapping to a C function to handle the request.</p>
<pre class="highlight c"><span class="n">boolean</span> <span class="nf">pins_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">send_error_code</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">send_content_type</span><span class="p">(</span><span class="s">&quot;application/javascript&quot;</span><span class="p">);</span>
  <span class="n">web_server</span><span class="p">.</span><span class="n">end_headers</span><span class="p">();</span>
  <span class="c1">// Handle sending back JSON from the current
</span>  <span class="c1">// state of the pins
</span>  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TinyWebServer</span><span class="o">::</span><span class="n">PathHandler</span> <span class="n">handlers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="s">&quot;/pins&quot;</span><span class="p">,</span> <span class="n">TinyWebServer</span><span class="o">::</span><span class="n">GET</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pins_handler</span><span class="p">},</span>
  <span class="p">{</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">TinyWebServer</span><span class="o">::</span><span class="n">GET</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">index_handler</span> <span class="p">},</span>
  <span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>
</pre>
<p>We now have a function that will respond to the web request when called, but we have no data being sent back yet. To do that, we&rsquo;ll need to create a helper function that can respond with JSON back to the request. </p>

<p>Since we&rsquo;re using C, a statically typed language, it&rsquo;s pretty difficult to handle the schema-less JSON data type. Since JSON is just text, we can manually create the JSON as a string and send it back as a response. </p>

<p>To handle this functionality, we&rsquo;ll create a new function that we&rsquo;ll call <code>pinsToString()</code>. As a helper function, we&rsquo;ve also wrapped the entire pin handling functionality into its own object. As the source code for this entire article is available, we won&rsquo;t describe specifically how the pin object works. For more information, see the <code>pins.h</code> source at:
<a href="https://github.com/fullstackio/ng-diuno/blob/master/arduino/sketch_dec30a/pin.h">https://github.com/fullstackio/ng-diuno/blob/master/arduino/sketch_dec30a/pin.h</a>.</p>

<h3>Iterating over our pins</h3>

<p>Before we are able to send out the pin status, we&rsquo;ll iterate over every pin that we&rsquo;re interested in. As we need to keep track of the <em>interesting</em> pins, we&rsquo;ll need to create a structure to hold onto all of the pins we want to query and modify.</p>
<pre class="highlight c"><span class="k">const</span> <span class="kt">int</span> <span class="n">numPins</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">Pin</span> <span class="n">pins</span><span class="p">[</span><span class="n">numPins</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">Pin</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">OUTPUT_T</span><span class="p">),</span>
  <span class="n">Pin</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">OUTPUT_T</span><span class="p">),</span>
  <span class="n">Pin</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">ONEWIRE</span><span class="p">),</span>
<span class="p">};</span>
<span class="n">OneWire</span> <span class="n">ds</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
</pre>
<p>With our pins array, we can walk through each pin and interact with each individually. We&rsquo;ll create a function that will handle updating the state of each pin:</p>
<pre class="highlight c"><span class="c1">// Iterate over pins and update each of their states
</span><span class="kt">void</span> <span class="nf">UpdatePinsState</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">numPins</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">getState</span><span class="p">();</span> <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>With the <code>UpdatePinsState()</code> function, we will walk through and collect the status of each pin, storing the updated status on the pin object itself.</p>

<p>Finally, we can walk through the pins and write our JSON object back from the <code>pinsToString()</code> function:</p>
<pre class="highlight javascript"><span class="kr">boolean</span> <span class="nx">pins_handler</span><span class="p">(</span><span class="nx">TinyWebServer</span><span class="o">&amp;</span> <span class="nx">web_server</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">web_server</span><span class="p">.</span><span class="nx">send_error_code</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="nx">web_server</span><span class="p">.</span><span class="nx">send_content_type</span><span class="p">(</span><span class="s2">&quot;application/javascript&quot;</span><span class="p">);</span>
  <span class="nx">web_server</span><span class="p">.</span><span class="nx">end_headers</span><span class="p">();</span>
  <span class="nx">pinsToString</span><span class="p">(</span><span class="nx">web_server</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// pinsToString() iterates over the pins and
// writes out the corresponding JSON object using
// the web request
</span><span class="nx">bool</span> <span class="nx">pinsToString</span><span class="p">(</span><span class="nx">TinyWebServer</span><span class="o">&amp;</span> <span class="nx">web_server</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">UpdatePinsState</span><span class="p">();</span>
  <span class="nx">web_server</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="nx">F</span><span class="p">(</span><span class="s2">&quot;{\&quot;pins\&quot;:[&quot;</span><span class="p">));</span>
  <span class="kr">int</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">numPins</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kr">int</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="nx">web_server</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="nx">F</span><span class="p">(</span><span class="s2">&quot;{\&quot;pin\&quot;:&quot;</span><span class="p">));</span>
    <span class="nx">web_server</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="nx">pins</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getPin</span><span class="p">());</span>
    <span class="nx">web_server</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="nx">F</span><span class="p">(</span><span class="s2">&quot;,\&quot;value\&quot;:&quot;</span><span class="p">));</span>
    <span class="nx">web_server</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="nx">pins</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">getState</span><span class="p">());</span>
    <span class="nx">web_server</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="nx">F</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">)</span> <span class="nx">web_server</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="nx">F</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="nx">web_server</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="nx">F</span><span class="p">(</span><span class="s2">&quot;]}&quot;</span><span class="p">));</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<h3>Modifying the pin state</h3>

<p>Now, when interacting in the other direction, where we want the Angular app to modify the state of the pins, we&rsquo;ll need to be able to send updated information back to the Arduino. As we previously mentioned, it&rsquo;s difficult to work with a schema-less JSON object inside the strictly statically typed C language. </p>

<p>Although there are some great libraries developed specifically to handle JSON from C and the Arduino (<a href="https://github.com/interactive-matter/aJson">aJson</a>), the parsing functionality is not always accurate and is very brittle in practice. </p>

<p>Rather than depend upon the JSON being parsed into a single object, we can create our own protocol to talk between the two parties.</p>

<p>At the heart of it, JSON is simply a method of wrapping data in a meaningful structure that is easily understood by both the human eye and JavaScript. We can create our own protocol that can take the place of JSON, but will still communicate the same information.</p>

<p>For instance, we can turn the 24-byte-long JSON object:</p>
<pre class="highlight javascript"><span class="p">{</span> <span class="na">pin</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="s1">'getTemp'</span> <span class="p">}</span> <span class="c1">// 24 characters long
</span></pre>
<p>into the 4-byte-long ASCII string:</p>
<pre class="highlight javascript"><span class="nx">p7a0</span>
</pre>
<p>and still achieve the same result when the Arduino receives the information and parses it.</p>

<p>Using JavaScript, it&rsquo;s fairly trivial to create a function that can turn our JSON string into the shorter, mini-protocol version of the request data. We can even still interact with the Arduino service as though we were sending the JSON through to the Arduino, using our Arduino service to modify the request.</p>
<pre class="highlight javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'fsArduino'</span><span class="p">,</span> <span class="p">[])</span>
<span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">'Arduino'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ARDUINO_URL</span><span class="p">,</span> <span class="nx">$http</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'getTemp'</span><span class="err">:</span> <span class="mi">0</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">actionifyPins</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pins</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">pins</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">pins</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">str</span> <span class="o">+=</span> <span class="s1">'p'</span> <span class="o">+</span> <span class="nx">p</span><span class="p">.</span><span class="nx">pin</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">mode</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span><span class="nx">str</span> <span class="o">+=</span> <span class="s1">'m'</span> <span class="o">+</span> <span class="nx">p</span><span class="p">.</span><span class="nx">mode</span><span class="p">;}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span><span class="nx">str</span> <span class="o">+=</span> <span class="s1">'v'</span> <span class="o">+</span> <span class="nx">p</span><span class="p">.</span><span class="nx">value</span><span class="p">;}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">p</span><span class="p">.</span><span class="nx">action</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">'undefined'</span><span class="p">)</span> <span class="p">{</span><span class="nx">str</span> <span class="o">+=</span> <span class="s1">'a'</span> <span class="o">+</span> <span class="nx">actions</span><span class="p">[</span><span class="nx">p</span><span class="p">.</span><span class="nx">action</span><span class="p">];}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="c1">// ...
</span></pre>
<p>Now, our <code>actionifyPins</code> function will turn the JSON objects we send it into the proper string for our Arduino to handle on the back end. We can use this function in our <code>setPins()</code> function from inside our Arduino service.</p>

<p>We&rsquo;ll also send the length of the string along with our request as a header. This point is important: We&rsquo;ll need to be explicit in handling the request on the Arduino.</p>
<pre class="highlight javascript">  <span class="kd">var</span> <span class="nx">service</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">getPins</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...
</span>      <span class="p">},</span>
      <span class="na">setPins</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pins</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">strAction</span> <span class="o">=</span> <span class="nx">actionifyPins</span><span class="p">(</span><span class="nx">pins</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">$http</span><span class="p">({</span>
          <span class="na">method</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
          <span class="na">url</span><span class="p">:</span> <span class="nx">ARDUINO_URL</span> <span class="o">+</span> <span class="s1">'/pins/update'</span><span class="p">,</span>
          <span class="na">data</span><span class="p">:</span> <span class="nx">strAction</span><span class="p">,</span>
          <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="s1">'X-Action-Len'</span><span class="err">:</span> <span class="nx">strAction</span><span class="p">.</span><span class="nx">length</span><span class="p">}</span>
        <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
        <span class="p">});</span>
      <span class="p">}</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="nx">service</span><span class="p">;</span>
<span class="err">}</span><span class="p">);</span>
</pre>
<h3>Handling the POST request on the Arduino</h3>

<p>In order to handle the POST request on the Arduino, we&rsquo;ll modify the <code>handlers[]</code> array again and add a new route to handle it. In this case, since we&rsquo;re interested in the <code>X-Action-Len</code> header, we&rsquo;ll need to add the header string to the <code>headers[]</code> array. This step tells the TinyWebServer that we&rsquo;re interested in using it in our requests.</p>
<pre class="highlight c"><span class="n">boolean</span> <span class="nf">digital_pin_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Handle POST request
</span>  <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">TinyWebServer</span><span class="o">::</span><span class="n">PathHandler</span> <span class="n">handlers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="s">&quot;/pins/update&quot;</span><span class="p">,</span> <span class="n">TinyWebServer</span><span class="o">::</span><span class="n">POST</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">digital_pin_handler</span><span class="p">},</span>
  <span class="p">{</span><span class="s">&quot;/pins&quot;</span><span class="p">,</span> <span class="n">TinyWebServer</span><span class="o">::</span><span class="n">GET</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pins_handler</span><span class="p">},</span>
  <span class="p">{</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">TinyWebServer</span><span class="o">::</span><span class="n">GET</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">index_handler</span> <span class="p">},</span>
  <span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">}</span>

<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">headers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">&quot;X-Action-Len&quot;</span><span class="p">,</span>
  <span class="nb">NULL</span>
<span class="p">};</span>
</pre>
<p>In order to handle the POST request, we&rsquo;ll need to fetch the length of the string we want to parse from the request. We can do that by requesting the header value from the request object.</p>
<pre class="highlight c"><span class="n">boolean</span> <span class="nf">digital_pin_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">action_str_len</span> <span class="o">=</span> <span class="n">web_server</span><span class="p">.</span><span class="n">get_header_value</span><span class="p">(</span><span class="s">&quot;X-Action-Len&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">action_str_len</span><span class="p">);</span>
    <span class="c1">// ...
</span><span class="p">}</span>
</pre>
<p>Given a known data length, we can pull off the full set of data from our request. </p>
<pre class="highlight c"><span class="n">boolean</span> <span class="nf">digital_pin_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">action_str_len</span> <span class="o">=</span> <span class="n">web_server</span><span class="p">.</span><span class="n">get_header_value</span><span class="p">(</span><span class="s">&quot;X-Action-Len&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">action_str_len</span><span class="p">);</span>

    <span class="kt">char</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="n">memset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
    <span class="n">get_request_data</span><span class="p">(</span><span class="n">web_server</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
    <span class="c1">// The request data is now available in the
</span>    <span class="c1">// data variable
</span><span class="p">}</span>

<span class="kt">void</span> <span class="nf">get_request_data</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length_str</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>
  <span class="n">Client</span><span class="o">&amp;</span> <span class="n">client</span> <span class="o">=</span> <span class="n">web_server</span><span class="p">.</span><span class="n">get_client</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">length_str</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
      <span class="n">ch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">client</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">ch</span> <span class="o">!=</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">str</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">str</span><span class="p">[</span><span class="n">length_str</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>Now that we have the request data available to us in the <code>data</code> variable, we can iterate over the data and take actions based upon the parsed data:</p>
<pre class="highlight c"><span class="k">enum</span> <span class="n">ActionTypes</span> <span class="p">{</span>
  <span class="n">GETTEMP</span>
<span class="p">};</span>

<span class="n">boolean</span> <span class="nf">digital_pin_handler</span><span class="p">(</span><span class="n">TinyWebServer</span><span class="o">&amp;</span> <span class="n">web_server</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...
</span>    <span class="kt">int</span> <span class="n">sLen</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">pinInt</span><span class="p">,</span> <span class="n">valueInt</span><span class="p">,</span> <span class="n">actionInt</span><span class="p">;</span>
    <span class="n">ActionTypes</span> <span class="n">actionT</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">currTemp</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">sLen</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'p'</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// We're handling a new pin
</span>        <span class="n">pinInt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">);</span>
        <span class="n">Pin</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">select_pin</span><span class="p">(</span><span class="n">pinInt</span><span class="p">);</span>

        <span class="k">while</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">'p'</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sLen</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">switch</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">case</span> <span class="sc">'v'</span><span class="p">:</span>
              <span class="c1">// Handle setting the value
</span>            <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="sc">'a'</span><span class="p">:</span>
              <span class="n">i</span><span class="o">++</span><span class="p">;</span> <span class="c1">// move to the next character
</span>              <span class="n">actionInt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="sc">'0'</span><span class="p">);</span>
              <span class="n">actionT</span> <span class="o">=</span> <span class="p">(</span><span class="n">ActionTypes</span><span class="p">)(</span><span class="n">actionInt</span><span class="p">);</span>

              <span class="k">switch</span><span class="p">(</span><span class="n">actionT</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">case</span> <span class="n">GETTEMP</span><span class="p">:</span>
                  <span class="n">currTemp</span> <span class="o">=</span> <span class="n">getTemp</span><span class="p">(</span><span class="n">ds</span><span class="p">);</span>
                  <span class="n">p</span><span class="o">-&gt;</span><span class="n">setCurrentValue</span><span class="p">(</span><span class="n">currTemp</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">break</span><span class="p">;</span>
            <span class="c1">// ...
</span>          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">free</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="n">web_server</span><span class="p">.</span><span class="n">send_error_code</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="n">web_server</span><span class="p">.</span><span class="n">send_content_type</span><span class="p">(</span><span class="s">&quot;application/json&quot;</span><span class="p">);</span>
    <span class="n">web_Server</span><span class="p">.</span><span class="n">end_headers</span><span class="p">();</span>

    <span class="n">pinsToString</span><span class="p">(</span><span class="n">web_server</span><span class="p">);</span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ...
</span><span class="n">Pin</span> <span class="o">*</span><span class="nf">select_pin</span><span class="p">(</span><span class="n">uint8_t</span> <span class="n">pinNumber</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">numPins</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">getPin</span><span class="p">()</span> <span class="o">==</span> <span class="n">pinNumber</span><span class="p">)</span> <span class="k">return</span> <span class="o">&amp;</span><span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>We did not include the entire source in this post for that action; essentially, we&rsquo;re walking through each of the characters in our POST data string and taking action on each one. In the case of the above demo string <code>p7a0</code>, we&rsquo;ll parse through to get the pin number using the <code>p</code> character and pulling off the number of the string and selecting the pin.</p>

<p>Until we reach a new <code>p</code>, we&rsquo;re going to walk through the string and look for actions, values, or modes to set. We&rsquo;ll come across the <code>a</code> characters and then attempt to map the action by number to the intended action. </p>

<p>In this case, since we&rsquo;re using enum to set the action types, we can reasonably set the action to be the first in the ActionTypes enum:</p>
<pre class="highlight c"><span class="k">enum</span> <span class="n">ActionTypes</span> <span class="p">{</span>
  <span class="n">GETTEMP</span>
<span class="p">};</span>
</pre>
<p>This works because the &lsquo;getTemp&rsquo; action in our Arduino service (in JavaScript) is set as the index of <code>0</code>:</p>
<pre class="highlight javascript"><span class="kd">var</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">'getTemp'</span><span class="err">:</span> <span class="mi">0</span>
<span class="p">};</span>
</pre>
<p>After that, the only component left missing is to send the response as a JSON object; we can use the <code>pinsToString()</code> method to handle sending back the JSON of the pins.</p>

<h3>Polling the temperature</h3>

<p>How do we get the temperature of the DS18S20 temperature sensor? Easy! We&rsquo;ll use the following function that handles reading the sensor:</p>
<pre class="highlight c"><span class="kt">float</span> <span class="n">getTemp</span><span class="p">(</span><span class="n">OneWire</span> <span class="n">sensor</span><span class="p">){</span>
  <span class="c1">//returns the temperature from one DS18S20 in DEG Fahrenheit
</span>  <span class="n">byte</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
  <span class="n">byte</span> <span class="n">addr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
  <span class="kt">float</span> <span class="n">celsius</span><span class="p">,</span> <span class="n">fahrenheit</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">sensor</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span> <span class="p">{</span>
     <span class="c1">//no more sensors on chain, reset search
</span>     <span class="n">sensor</span><span class="p">.</span><span class="n">reset_search</span><span class="p">();</span>
     <span class="k">return</span> <span class="o">-</span><span class="mi">1000</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">OneWire</span><span class="o">::</span><span class="n">crc8</span><span class="p">(</span> <span class="n">addr</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">!=</span> <span class="n">addr</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span> <span class="p">{</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;CRC is not valid!&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="o">-</span><span class="mi">1000</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x10</span> <span class="o">&amp;&amp;</span> <span class="n">addr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x28</span><span class="p">)</span> <span class="p">{</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Device is not recognized&quot;</span><span class="p">);</span>
     <span class="k">return</span> <span class="o">-</span><span class="mi">1000</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">sensor</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
  <span class="n">sensor</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
  <span class="n">sensor</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mh">0x44</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// start conversion, with parasite power on at the end
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

  <span class="n">byte</span> <span class="n">present</span> <span class="o">=</span> <span class="n">sensor</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span>
  <span class="n">sensor</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>  
  <span class="n">sensor</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="mh">0xBE</span><span class="p">);</span> <span class="c1">// Read Scratchpad
</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// we need 9 bytes
</span>    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensor</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="n">sensor</span><span class="p">.</span><span class="n">reset_search</span><span class="p">();</span>

  <span class="n">byte</span> <span class="n">MSB</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="n">byte</span> <span class="n">LSB</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

  <span class="n">int16_t</span> <span class="n">raw</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="n">raw</span> <span class="o">=</span> <span class="n">raw</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw</span> <span class="o">&amp;</span> <span class="mh">0xFFF0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="n">celsius</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">raw</span> <span class="o">/</span> <span class="mi">16</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">fahrenheit</span> <span class="o">=</span> <span class="n">celsius</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">32</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
  <span class="c1">// float tempRead = ((MSB &lt;&lt; 8) | LSB); //using two's compliment
</span>  <span class="c1">// float TemperatureSum = tempRead / 16;
</span>
  <span class="k">return</span> <span class="n">fahrenheit</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>With that, we&rsquo;re ready to fetch and send data to and from the Angular app to be handled by the Arduino.</p>

<h3>Interface elements</h3>

<p>Finally, we&rsquo;ll want to show a meaningful interface that shows our data in a compelling manner. Enter D3.</p>

<p>D3 is a dynamic data library that powers many data visualizations on the web today. It&rsquo;s a fantastic framework for building visualizations of any kind. It&rsquo;s the perfect tool to make a dynamic interface such as a temperature gauge. We&rsquo;ll use D3 to build our interface. </p>

<p>First, we&rsquo;ll need to create a D3 service that will make the <code>window.d3</code> object accessible as an Angular object. We&rsquo;ll then <em>inject</em> this incredibly simple service in our <code>temperatureGauge</code> directive:</p>
<pre class="highlight javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">)</span>
<span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">'D3'</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">D3</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">d3</span><span class="p">;</span>
<span class="p">});</span>
</pre>
<p>In our <code>temperatureGauge</code> directive, we can inject the D3 service and start using it immediately. We&rsquo;ll add a template and append a D3 SVG object inside of it. As we don&rsquo;t intend this post as a tutorial on D3, we&rsquo;ve shown the code in its entirety below.</p>
<pre class="highlight javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">'temperatureGauge'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">D3</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">template</span><span class="p">:</span> <span class="s1">'&lt;div class=&quot;thermometer&quot;&gt;&lt;svg&gt;&lt;/svg&gt;&lt;/div&gt;'</span><span class="p">,</span>
      <span class="na">replace</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">scope</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">'ngModel'</span><span class="err">:</span> <span class="s1">'='</span>
      <span class="p">},</span>
      <span class="na">restrict</span><span class="p">:</span> <span class="s1">'EA'</span><span class="p">,</span>
      <span class="na">link</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">D3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'.thermometer'</span><span class="p">),</span>
            <span class="nx">w</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">width</span> <span class="o">||</span> <span class="nx">el</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">clientWidth</span><span class="p">,</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">height</span> <span class="o">||</span> <span class="nx">el</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">clientHeight</span><span class="p">,</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nx">pi</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">'svg'</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'width'</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'height'</span><span class="p">,</span> <span class="nx">h</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'g'</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'transform'</span><span class="p">,</span> <span class="s1">'translate('</span> <span class="o">+</span> <span class="nx">w</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="s1">','</span> <span class="o">+</span> <span class="nx">h</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">pie</span> <span class="o">=</span> <span class="nx">D3</span><span class="p">.</span><span class="nx">layout</span><span class="p">.</span><span class="nx">pie</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">startAngle</span><span class="p">(</span><span class="o">-</span><span class="nx">pi</span><span class="o">/</span><span class="mf">1.2</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">endAngle</span><span class="p">(</span><span class="nx">pi</span><span class="o">/</span><span class="mf">1.2</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">arc</span> <span class="o">=</span> <span class="nx">D3</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">arc</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">innerRadius</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">outerRadius</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">);</span>

        <span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">'path.degree'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">pie</span><span class="p">(</span><span class="nx">D3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">})))</span>
          <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'degree'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'d'</span><span class="p">,</span> <span class="nx">arc</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">handle</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'g'</span><span class="p">);</span>
        <span class="nx">handle</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'rect'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'class'</span><span class="p">,</span> <span class="s1">'handle'</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'width'</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'height'</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'x'</span><span class="p">,</span> <span class="nx">r</span> <span class="o">-</span> <span class="mi">65</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">scale</span> <span class="o">=</span> <span class="nx">D3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mi">65</span><span class="p">,</span><span class="mi">85</span><span class="p">])</span>
          <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">0</span><span class="p">]);</span>

        <span class="kd">var</span> <span class="nx">display</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'text'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">'72'</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'y'</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>

        <span class="nx">scope</span><span class="p">.</span><span class="nx">$watch</span><span class="p">(</span><span class="s1">'ngModel'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>

          <span class="nx">handle</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'transform'</span><span class="p">,</span> <span class="s1">'rotate('</span><span class="o">+</span><span class="nx">scale</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="s1">')'</span><span class="p">);</span>

          <span class="nx">display</span><span class="p">.</span><span class="nx">datum</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">tween</span><span class="p">(</span><span class="s1">'text'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">D3</span><span class="p">.</span><span class="nx">interpolate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">textContent</span><span class="p">,</span> <span class="nx">d</span><span class="p">);</span>
              <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">i</span><span class="p">(</span><span class="nx">t</span><span class="p">));</span>
              <span class="p">};</span>
            <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">});</span>
</pre>
<p>For more information on using Angular and D3 together, check out our book at <a href="https://leanpub.com/d3angularjs">https://leanpub.com/d3angularjs</a>. We give an in-depth introduction to D3 and demonstrate the best practices for using it with AngularJS.</p>

<h3>Conclusion</h3>

<p>Above all else, we hope this post has inspired you to explore how we can use the power of Angular to engage with the physical world &ndash; we&rsquo;re not limited to the browser. </p>

<p>If you want to become an AngularJS expert today, check out our book at <a href="https://www.ng-book.com/">ng-book.com</a>. It&rsquo;s the most feature-complete AngularJS book available on the market today. Catering to beginners and experts alike, ng-book will help you become an Angular expert.</p>

<h3>Video</h3>

<div name="video" id="video"></div>

<iframe width="640" height="360" src="//www.youtube.com/embed/MhVgGE-pgEY" frameborder="0" allowfullscreen></iframe>

<h3>ngConf slides</h3>

<iframe src="http://www.slideshare.net/slideshow/embed_code/30244687" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>


          <div class="container" id="signupApp" ng-cloak>
  <div id="topbar_signup_embed">
  Get the weekly email all focused on AngularJS. <b>Sign up below</b> to receive the weekly email and exclusive content.
  <form name="ngSignup" action="http://willcodeforfoo.us6.list-manage1.com/subscribe/post?u=86d6f14c7cc955128485e3b8e&amp;id=fa61364f13" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    
    <div class="row collapse">
      <div class="small-9 columns">
        <input ng-class="{error: ngSignup.email.$dirty && ngSignup.email.$invalid}" type="email" ng-minlength=3 ng-model="ngSignup.email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Email address" required>
      </div>
      <div class="small-3 columns">
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" ng-disabled="ngSignup.$invalid" class="button postfix"></div>
      </div>
        <div class="small-12 columns error" ng-show="ngSignup.EMAIL.$dirty && ngSignup.EMAIL.$invalid">
          <small class="error" ng-show="ngSignup.EMAIL.$error.required">Your email is required.</small>
          <small class="error" ng-show="ngSignup.EMAIL.$error.minlength">Your email is required to be at least 3 characters</small>
          <small class="error" ng-show="ngSignup.EMAIL.$error.email">That is not a valid email. Please input a valid email.</small>
        </div>
      </div>
  </form>
  </div>
</div>

<script type="text/javascript">
  if (typeof(app) == 'undefined') {
    angular.module("signupApp", [])
    .controller("mailChimpValidation", ['$scope', function($scope) {}]);
    var ele = document.getElementById("signupApp");
    angular.element(ele, ['signupApp']);
  }
</script>
          <section id="sample_chapter" ng-app="ngBookApp">    <div class="content">      <h3 class="title">Download a free sample of the ng-book: The Complete Book on AngularJS</h3> <span class="image"><img src="http://www.ng-book.com/images/flatbook-ngbook-small.png" alt="book"></span><div class="desc">It's free, so just enter your email address and the PDF will be sent directly to your inbox.</div>    </div>    <div class="form" ng-init="signedup=false" ng-show="!signuped">      <form action="http://willcodeforfoo.us6.list-manage.com/subscribe/post?u=86d6f14c7cc955128485e3b8e&amp;id=7bbfaae868" method="post" id="mc-embedded-subscribe-form" name="ngBookSignup" class="validate ng-pristine ng-invalid ng-invalid-required" target="_blank" novalidate="">
<div class="mc-field-group">          <input type="email" ng-model="ngBookSignup.email" ng-class="{error: ngBookSignup.email.$dirty &amp;&amp; ngBookSignup.email.$invalid}" value="" name="EMAIL" placeholder="Your email address" class="required email ng-pristine ng-valid ng-valid-email ng-valid-minlength" id="mce-EMAIL" ng-minlength="3">        </div>        <div id="mce-responses" class="clear">          <div class="response" id="mce-error-response" style="display:none"></div>          <div class="response" id="mce-success-response" style="display:none"></div>        </div>        <div class="clear"><input type="submit" value="Send me a free chapter" name="subscribe" id="ngBookSignupSubmit" ng-disabled="ngBookSignup.$invalid" class="button postfix" ng-click="signedup=true" disabled="disabled"></div>      </form>      <div ng-show="signedup" class="ng-hide">      <p>Sweet! We are glad to hear you're interested in learning AngularJS. Enjoy the free chapter. We put a lot of work into building the book series, so we hope you like it!      Talk soon</p>      </div>      <div class="desc">        We won't ever send you spam! You can unsubscribe at any time.      </div>    </div>  </section>

          <footer>
            <ul class="actions">
              <li><a href="/articles"><span class="arrow">←</span> Back to articles</a></li>
              <li><a href="http://twitter.com/home/?status=Embedding Angular in the physical world - http://ng-newsletter.com/posts/embedded-angular.html via @ngnewsletter" target="_blank"><img src="/img/twitter-bird-blue-on-white.png" style="width: 56px; height: 26px;" />Share on twitter</a></li>
            </ul>
          </footer>

        </article>

        <section id="comments">
            <h2 class="gamma">Comments</h2>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ngnewsletter'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>

        

        <script type="text/javascript" src="/js/vendor/zepto.js"></script>
<script type="text/javascript" src="/js/vendor/foundation.min.js"></script>

<script src="/js/main.js"></script>

        </div>
    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28176211-3', 'ng-newsletter.com');
  ga('send', 'pageview');

</script>

<script type="text/javascript">
  var $mcGoal = {'settings':{'uuid':'86d6f14c7cc955128485e3b8e','dc':'us6'}};
  (function() {
     var sp = document.createElement('script'); sp.type = 'text/javascript'; sp.async = true; sp.defer = true;
    sp.src = ('https:' == document.location.protocol ? 'https://s3.amazonaws.com/downloads.mailchimp.com' : 'http://downloads.mailchimp.com') + '/js/goal.min.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sp, s);
  })(); 
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function(){try{var s,a,i,j,r,c,l=document.getElementsByTagName("a"),t=document.createElement("textarea");for(i=0;l.length-i;i++){try{a=l[i].getAttribute("href");if(a&&"www.cloudflare.com/email-protection"==a.substr(7 ,35)){s='';j=43;r=parseInt(a.substr(j,2),16);for(j+=2;a.length-j&&a.substr(j,1)!='X';j+=2){c=parseInt(a.substr(j,2),16)^r;s+=String.fromCharCode(c);}j+=1;s+=a.substr(j,a.length-j);t.innerHTML=s.replace(/</g,"&lt;").replace(/>/g,"&gt;");l[i].setAttribute("href","mailto:"+t.value);}}catch(e){}}}catch(e){}})();
/* ]]> */
</script>
</body>
</html>
