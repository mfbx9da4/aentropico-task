<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="width=device-width" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">

<title>What you need to know about Angular SEO | ng-newsletter</title>

<meta name="author" content="Ari Lerner">
<meta name="description" content="Everything you need to know about Angular SEO. We're covering from server-side DIY SEO servers to using professional services. Interested in getting your Angular app SEO'd? Check it out. angularjs angularjs tutorial angular">
<meta name="keywords" content="angularjs getting started with angularjs how to configure angularjs seo angularjs angular seo seo javascript angularjs seo seo angular javascript seo clientside seo angular tutorial angularjs tutorial angularjs angularjs tutorial angular realtime firebase angularfire">

<meta name="msvalidate.01" content="BE7DA3BEF0F11153F6E4B5585C12DB20" />
<meta property="og:type" content="website" />
<meta property="og:title" content="ng-newsletter" />
<meta property="og:url" content="http://ng-newsletter.com" />
<meta property="og:image" content="http://ng-newsletter.com/img/" />
<meta property="og:description" content="Everything you need to know about Angular SEO. We're covering from server-side DIY SEO servers to using professional services. Interested in getting your Angular app SEO'd? Check it out." />

<meta name="twitter:card" value="summary" />
<meta name="twitter:creator" value="@auser" />
<meta name="twitter:title" value="ng-newsletter" />
<meta name="twitter:description" value="Everything you need to know about Angular SEO. We're covering from server-side DIY SEO servers to using professional services. Interested in getting your Angular app SEO'd? Check it out." />
<meta name="twitter:image" value="http://ng-newsletter.com/img/" />

<link rel="alternate" type="application/rss+xml" href="feed.rss" title="Sitewide RSS 2.0 Feed">
<link rel="alternate" type="application/atom+xml" href="atom.xml" title="Sitewide ATOM Feed">
<link rel="alternate" type="application/atom+json" href="atom.json" title="Sitewide JSON Feed">

<link href="/favicon.ico" rel="icon" type="image/ico" />
<link href="/css/site.css" media="screen" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Roboto:400italic,700italic,400,700|Open+Sans:r,i,b,bi|Bitter:r,i,b" media="screen" rel="stylesheet" type="text/css" />
<script src="/js/vendor/custom.modernizr.js"></script>
<script src="/js/vendor/d3.v3.min.js"></script>
<script src="/js/vendor/angular/angular.min.js"></script>
<script src="/js/vendor/angular-route/angular-route.min.js"></script>
<script src="/js/vendor/angular-animate.min.js"></script>
<script src="/js/vendor/angular-translate.min.js"></script>
<script src="/js/vendor/angular-cookies/angular-cookies.min.js"></script>


</head>
<body>

    
    <div id="header">
  <div id="topNav">
    <nav class="top-bar">
      <ul class="title-area">
        <li class="name">
          <h1><a href="/">ng-newsletter</a></h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
      </ul>

      <section class="top-bar-section">
        <ul class="right">
      		<li><a href="/posts">Articles</a></li>
          <li><a href="/advent2013/">25 days of Angular</a></li>
          <li><a href="/books">Books</a></li>
          <li><a href="/sponsor">Sponsorship</a></li>
        </ul>
      </section>
    </nav>
  </div>
  <div class="headerContent">
  </div>
</div>

    <div class="container">
      <div id="article">
        <article class="post">
          <header>
            <h1 class="mega">What you need to know about Angular SEO</h1>
          </header>
          
          <p>Search engines, such as Google and Bing are engineered to crawl static web pages, not javascript-heavy, client-side apps. This is typical of a search engine which does not render javascript when the search bot is crawling over web pages. </p>

<p>This is because our javascript-heavy apps need a javascript engine to run, like PhantomJS or v8, for instance. Web crawlers typically load a web page without using a javascript interpreter. </p>

<blockquote>
<p>Search engines do not include JS interpreters in their crawlers for good reason, they don&rsquo;t need to and it slows them down and makes them more inefficient for crawling the web.</p>
</blockquote>

<p>Are we out of luck for providing good SEO for our Angular apps? This article will show you exactly what you need to know to get your app indexed <em>today</em>.</p>

<h2>Getting angular apps indexed</h2>

<p>There are several different ways that we can tell Google to handle indexing our app. One, the more common approach is by using a backend to serve our angular app. This has the advantage of being simple to implement without much duplication of code. </p>

<p>A second approach is to render all of the content delivered by our angular app inside a <code>&lt;noscript&gt;</code> tag in our javascript. We&rsquo;re not going to cover the second approach </p>

<p>In this article, we&rsquo;re going to walk through how you can build an SEO toolchain for your workflow, presenting a bunch of different options for you to choose what works best for you.</p>

<h2>How modern search engines work with client-side apps</h2>

<p>Google and other advanced search engines support the hashbang URL format, which is used to identify the current page that&rsquo;s being accessed at a given URL. These search engines transform this URL into a custom URL format that enables them to be accessible by the server. </p>

<p>The search engine visits the URL and expects to get the HTML that our browsers will receive, with the fully rendered HTML content. For instance, Google will turn the hashbang URL from:</p>
<pre class="highlight html">http://www.ng-newsletter.com/#!/signup/page
</pre>
<p>Into the URL:</p>
<pre class="highlight html">http://www.ng-newsletter.com/?_escaped_fragment_=/signup/page
</pre>
<p>Within our angular app, we will need to tell Google to handle our site slightly differently depending upon which style we handle.</p>

<h3>Hashbang syntax</h3>

<p>Google&rsquo;s Ajax crawling specification was written and originally intended for delivering URLs with the hashbang syntax, which was an original method of creating permalinks for JS applications. </p>

<p>We&rsquo;ll need to configure our app to use the <code>hashPrefix</code> (default) in our routing. This will turn our routes from simply using the <code>/#/</code> syntax to the <code>/#!/</code> syntax:</p>
<pre class="highlight javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[])</span>
<span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s1">'$location'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$location</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$location</span><span class="p">.</span><span class="nx">hashPrefix</span><span class="p">(</span><span class="s1">'!'</span><span class="p">);</span>
<span class="p">}]);</span>
</pre>
<h3>HTML5 routing mode</h3>

<p>The new HTML5 pushState doesn&rsquo;t work the same way as it modifies the browser&rsquo;s URL and history. To get angular apps to &ldquo;fool&rdquo; the search bot, we can add a simple element to the header:</p>
<pre class="highlight html"><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;fragment&quot;</span> <span class="na">content=</span><span class="s">&quot;!&quot;</span><span class="nt">&gt;</span>
</pre>
<p>This tells the Google spider to use the new crawling spec to crawl our site. When it encounters this tag, instead of crawling our site like <em>normal</em>, it will revisit the site using the <code>?_escaped_fragment_=</code> tag.</p>

<p>This assumes that we&rsquo;re using HTML5 mode with the <code>$location</code> service:</p>
<pre class="highlight javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[])</span>
<span class="p">.</span><span class="nx">config</span><span class="p">([</span><span class="s1">'$location'</span><span class="p">,</span> 
<span class="kd">function</span><span class="p">(</span><span class="nx">$location</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$location</span><span class="p">.</span><span class="nx">html5Mode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">}]);</span>
</pre>
<p>With the <code>_escaped_fragment_</code> in our query string, we can use our backend server to serve static HTML instead of our client-side app. </p>

<p>Now, our backend can detect if the request has the <code>_escaped_fragment_</code> in the request and and we can serve static HTML back instead of our pure angular app so that the crawler can crawl our site as though it were a static site.</p>

<h2>Options for handling SEO from the server-side</h2>

<p>We have a number of different options available to us to make our site SEO-friendly. We&rsquo;ll walk through three different ways to deliver our apps from the server-side:</p>

<ul>
<li>Using node/express middleware</li>
<li>Use Apache to rewrite URLS</li>
<li>Use nginx to proxy URLS</li>
</ul>

<h3>Using node/express middleware</h3>

<p>To deliver static HTML using NodeJS and Express (the web application framework for NodeJS), we&rsquo;ll add some middleware that will look for the <code>_escaped_fragment_</code> in our query parameters. </p>

<p>In this case, this middleware will only be called if the <code>_escaped_fragment_</code> exists as a query parameter, otherwise it will continue along the call chain.</p>
<pre class="highlight javascript"><span class="c1">// In our app.js configuration
</span><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">_escaped_fragment_</span><span class="p">;</span>

  <span class="c1">// If there is no fragment in the query params
</span>  <span class="c1">// then we're not serving a crawler
</span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fragment</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>

  <span class="c1">// If the fragment is empty, serve the
</span>  <span class="c1">// index page
</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">fragment</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">fragment</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="nx">fragment</span> <span class="o">=</span> <span class="s2">&quot;/index.html&quot;</span><span class="p">;</span>

  <span class="c1">// If fragment does not start with '/'
</span>  <span class="c1">// prepend it to our fragment
</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="nx">fragment</span> <span class="o">=</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">fragment</span><span class="p">;</span>

  <span class="c1">// If fragment does not end with '.html'
</span>  <span class="c1">// append it to the fragment
</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'.html'</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">fragment</span> <span class="o">+=</span> <span class="s2">&quot;.html&quot;</span><span class="p">;</span>

  <span class="c1">// Serve the static html snapshot
</span>  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&quot;/snapshots&quot;</span> <span class="o">+</span> <span class="nx">fragment</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendfile</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p>This middleware expects our snapshots to exist in a top-level directory called &lsquo;/snapshots&rsquo; and serve files based upon the request path.</p>

<p>For instance, it will serve a request to <code>/</code> as <code>index.html</code>, while it will serve a request to <code>/about</code> as <code>about.html</code> in the snapshots directory.</p>

<h3>Use Apache to rewrite URLS</h3>

<p>If we&rsquo;re using the <a href="http://httpd.apache.org/">apache server</a> to deliver our angular app, we can add a few lines to our configuration that will serve snapshots instead of our javascript app.</p>

<p>We can use the <code>mod_rewrite</code> mod to detect if the route being requested includes the <code>_escaped_fragment_</code> query parameter or not. If it <strong>does</strong> include it, then we&rsquo;ll rewrite the request to point to the static version in the <code>/snapshots</code> directory.</p>

<p>In order to set the rewrite in motion, we&rsquo;ll need to enable the appropriate modules:</p>
<pre class="highlight shell"><span class="gp">$ </span>a2enmod proxy
<span class="gp">$ </span>a2enmod proxy_http
</pre>
<p>Then we&rsquo;ll need to reload the apache config:</p>
<pre class="highlight shell"><span class="gp">$ </span>sudo /etc/init.d/apache2 reload
</pre>
<p>We can set the rewrite rules either in the virtualhost configuration for the site or the <code>.htaccess</code> file that sits at the root of the server directory.</p>
<pre class="highlight shell">RewriteEngine On
Options +FollowSymLinks
RewriteCond %<span class="o">{</span>REQUEST_URI<span class="o">}</span>  ^/<span class="err">$</span>
RewriteCond %<span class="o">{</span>QUERY_STRING<span class="o">}</span> ^_escaped_fragment_<span class="o">=</span>/?<span class="o">(</span>.<span class="k">*</span><span class="o">)</span><span class="err">$</span>
RewriteRule ^<span class="o">(</span>.<span class="k">*</span><span class="o">)</span><span class="nv">$ </span>/snapshots/%1? <span class="o">[</span>NC,L]
</pre>
<h3>Use nginx to proxy URLS</h3>

<p>If we&rsquo;re using <a href="http://wiki.nginx.org/Main">nginx</a> to serve our angular app, we can add some configuration to serve snapshots of our app if there is an <code>_escaped_fragment_</code> parameter in the query strings.</p>

<p>Unlike Apache, nginx does not require us to enable a module, so we can simply update our configuration to replace the path with the question file instead.</p>

<p>In our nginx configuration file (For instance, <code>/etc/nginx/nginx.conf</code>), ensure your configuration looks like this:</p>
<pre class="highlight shell">server <span class="o">{</span>
  listen 80;
  server_name example;

  <span class="k">if</span> <span class="o">(</span><span class="nv">$args</span> ~ <span class="s2">&quot;_escaped_fragment_=/?(.+)&quot;</span><span class="o">)</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">$path</span> <span class="nv">$1</span>;
    rewrite ^ /snapshots/<span class="nv">$path</span> last;
  <span class="o">}</span>

  location / <span class="o">{</span>
    root /web/example/current/;
    <span class="c"># Comment out if using hash urls</span>
    <span class="k">if</span> <span class="o">(</span>!-e <span class="nv">$request_filename</span><span class="o">)</span> <span class="o">{</span>
      rewrite ^<span class="o">(</span>.<span class="k">*</span><span class="o">)</span><span class="nv">$ </span>/index.html <span class="nb">break</span>;
    <span class="o">}</span>
    index index.html;
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>Once this is complete, we&rsquo;re good to reload our configuration:</p>
<pre class="highlight shell">sudo /etc/init.d/nginx reload
</pre>
<h2>Taking snapshots</h2>

<p>We can take snapshots of our HTML app to deliver our backend app, using a tool like <a href="http://phantomjs.org/">PhantomJS</a> or <a href="http://zombie.labnotes.org/">zombie.js</a> to render our pages. When a page is requested by Google using the <code>_escaped_fragment_</code> query parameter, we can simply return and render this page.</p>

<p>We&rsquo;ll discuss two methods to take snapshots, using zombie.js and using a grunt tool. We&rsquo;re not covering using the fantastic <a href="http://phantomjs.org/">PhantomJS</a> tool as there are plenty of great resources that demonstrate it.</p>

<h2>Using Zombie to homebrew snapshots</h2>

<p>To set up <a href="http://zombie.labnotes.org/">zombie.js</a>, we&rsquo;ll need to install the <code>npm</code> package <code>zombie</code>:</p>
<pre class="highlight shell"><span class="gp">$ </span>npm install zombie
</pre>
<p>Now, we&rsquo;ll use NodeJS to save our file using <code>zombie</code>. First, a few helper methods we&rsquo;ll use in the process:</p>
<pre class="highlight javascript"><span class="kd">var</span> <span class="nx">Browser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'zombie'</span><span class="p">),</span>
    <span class="nx">url</span>     <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'url'</span><span class="p">),</span>
    <span class="nx">fs</span>      <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">),</span>
    <span class="nx">saveDir</span> <span class="o">=</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">'/snapshots'</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">scriptTagRegex</span> <span class="o">=</span> <span class="sr">/&lt;script\b[^&lt;]*(?:(?!&lt;\/script&gt;)&lt;[^&lt;]*)*&lt;\/script&gt;/gi</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">stripScriptTags</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">scriptTagRegex</span><span class="p">,</span> <span class="s1">''</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">browserOpts</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">waitFor</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
  <span class="na">loadCSS</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
  <span class="na">runScripts</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">saveSnapshot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">lastIdx</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">'#/'</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">lastIdx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// If we're using html5mode
</span>    <span class="nx">path</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">uri</span><span class="p">).</span><span class="nx">pathname</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// If we're using hashbang mode
</span>    <span class="nx">path</span> <span class="o">=</span> 
      <span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">lastIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span> <span class="o">===</span> <span class="s1">'/'</span><span class="p">)</span> <span class="nx">path</span> <span class="o">=</span> <span class="s2">&quot;/index.html&quot;</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'.html'</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="nx">path</span> <span class="o">+=</span> <span class="s2">&quot;.html&quot;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">saveDir</span> <span class="o">+</span> <span class="nx">path</span><span class="p">;</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">fd</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">fd</span><span class="p">,</span> <span class="nx">body</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre>
<p>Now all we need to do is run through our pages, turn every link from a relative link into an absolute link (so the crawler can follow them), and save the resulting html.</p>

<p>We&rsquo;re setting a relatively high <code>waitFor</code> in the browser options above. This will cover 90% of the cases we care about. If we want to get more precise on how and when we take a snapshot, instead of waiting the 2 seconds we&rsquo;ll need to modify our angular app to fire an event and listen for the event in our zombie browser. </p>

<p>Since we like to automate as much as possible and prefer not to muck with our angular code, we prefer to set our timeout relatively high to attempt to let the code settle down.</p>

<p>Our <code>crawlPage()</code> function:</p>
<pre class="highlight javascript"><span class="kd">var</span> <span class="nx">crawlPage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// location = window.location
</span>  <span class="k">if</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Browser</span><span class="p">(</span><span class="nx">browserOpts</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="c1">// Turn links into absolute links
</span>      <span class="c1">// and save them, if we need to
</span>      <span class="c1">// and we haven't already crawled them
</span>      <span class="kd">var</span> <span class="nx">links</span> <span class="o">=</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">queryAll</span><span class="p">(</span><span class="s1">'a'</span><span class="p">);</span>
      <span class="nx">links</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">href</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">absUrl</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">href</span><span class="p">);</span>
        <span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">,</span> <span class="nx">absUrl</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">absUrl</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">absUrl</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>

      <span class="c1">// Save
</span>      <span class="nx">saveSnapshot</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">html</span><span class="p">());</span>
      <span class="c1">// Call again on the next iteration
</span>      <span class="nx">crawlPage</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">arr</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Now we can simply call the method on our first page:</p>
<pre class="highlight javascript"><span class="nx">crawlPage</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;http://localhost:9000&quot;</span><span class="p">]);</span>
</pre>
<h2>Using grunt-html-snapshot</h2>

<p>Our prefered method of taking snapshots is by using the grunt tool <code>grunt-html-snapshot</code>. Since we use <a href="http://yeoman.io">yeoman</a> and grunt is already in our build process, we set up this task to run after we make a release of our apps.</p>

<p>To install <code>grunt-html-snapshot</code>, we&rsquo;ll use npm like so:</p>
<pre class="highlight shell">npm install grunt-html-snapshot --save-dev
</pre>
<p>If we&rsquo;re not using <a href="http://yeoman.io">yeoman</a>, we&rsquo;ll need to include this task as a grunt task in our <code>Gruntfile.js</code>:</p>
<pre class="highlight javascript"><span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">'grunt-html-snapshot'</span><span class="p">);</span>
</pre>
<p>Once this is set, we&rsquo;ll set some configuration about our site. To set up configuration, we&rsquo;ll create a new config block in our <code>Gruntfile.js</code> that looks like:</p>
<pre class="highlight javascript"><span class="nx">htmlSnapshot</span><span class="err">:</span> <span class="p">{</span>
  <span class="na">debug</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">options</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">},</span>
  <span class="na">prod</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">options</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>Now we simply get to add our different options for the different stages:</p>
<pre class="highlight javascript"><span class="nx">htmlSnapshot</span><span class="err">:</span> <span class="p">{</span>
  <span class="na">debug</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">options</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">snapshotPath</span><span class="p">:</span> <span class="s1">'snapshots/'</span><span class="p">,</span>
      <span class="na">sitePath</span><span class="p">:</span> <span class="s1">'http://127.0.0.1:9000/'</span><span class="p">,</span>
      <span class="na">msWaitForPages</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
      <span class="na">urls</span><span class="p">:</span> <span class="p">[</span>
        <span class="s1">'/'</span><span class="p">,</span>
        <span class="s1">'/about'</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">prod</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">options</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
<p>To see a list of the entire available configuration options, check out the documentation page at <a href="https://github.com/cburgdorf/grunt-html-snapshot">https://github.com/cburgdorf/grunt-html-snapshot</a>.</p>

<h2>Prerender.io</h2>

<p>Alternatively, we can use an open-source tool such as <a href="http://prerender.io/">Prerender.io</a>, which includes a node server that renders our site on-the-fly and an express middleware that communicates with the backend to prerenderHTML on-the-fly.</p>

<p>Essentially, prerender.io will take a url and returns the rendered HTML (with no script tags). Essentially, the prerender server we&rsquo;ll deploy will be called from our app like so:</p>

<p><code>GET http://our-prerenderserver.com/http://localhost:9000/#!/about</code></p>

<p>This GET will return the rendered content of our <code>#/about</code> page.</p>

<p>Setting up a prerender cluster is actually pretty easy to do. We&rsquo;ll also show you how to integrate your own prerender server into your node app. Prerender.io is also avaialble for Ruby on Rails through a gem, but we won&rsquo;t cover how to set it up.</p>

<p>Setting up our own server to run it is pretty easy. Simply run the <code>npm install</code> to install the dependencies and run the command through either foreman or node:</p>
<pre class="highlight shell">npm install
node index.js
<span class="c"># Or through foreman</span>
foreman start
</pre>
<p>The prerender library is also convenient to run on heroku:</p>
<pre class="highlight shell"><span class="gp">$ </span>git clone https://github.com/collectiveip/prerender.git
<span class="gp">$ </span>heroku create
<span class="gp">$ </span>git push heroku master
</pre>
<p>We store our rendered HTML in S3, so we recommend you use the built-in s3 cache. Read the docs how to set this up <a href="https://github.com/collectiveip/prerender#s3-html-cache">here</a>.</p>

<p>After our server is running, we just need to integrate the fetching through our app. In express, this is very easy using the node library <code>prerender-node</code>.</p>

<p>To install <code>prerender-node</code>, we&rsquo;ll use npm:</p>
<pre class="highlight shell"><span class="gp">$ </span>npm install --save prerender-node
</pre>
<p>After this is installed, we&rsquo;ll tell our express app to use this middleware:</p>
<pre class="highlight javascript"><span class="kd">var</span> <span class="nx">prerender</span> <span class="o">=</span> 
  <span class="nx">require</span><span class="p">(</span><span class="s1">'prerender-node'</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="s1">'prerenderServiceUrl'</span><span class="p">,</span> <span class="s1">'http://our-prerenderserver.com/'</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">prerender</span><span class="p">);</span>
</pre>
<p>And that is it! This tells our express app that if we see a crawler request (defined by having the <code>_escaped_fragment_</code> or the user agent string), then make a GET request to our prerender service at the appropriate url and get the prerendered HTML for the page.</p>

<h2>Professional alternatives</h2>

<p>Although we present a relatively easy methods of creating SEO opportunities for our apps, it does take work to set it up and maintain. There are definitely professional services that offer SEO as a service. </p>

<p>We recommend one of our sponsors, <a href="http://www.brombone.com/">brombone</a> that has fantastic service and great service.</p>

<p>Other professional SEO services include:</p>

<ul>
<li><a href="http://getseojs.com/">SEO.js</a>, which provides node/express middleware.</li>
<li><a href="http://www.seo4ajax.com/">SEO4Ajax</a> also looks and acts very simple to implement as well. Definitely worth checking out.</li>
<li><a href="http://www.rankjs.com/">RankJS</a>, completely free and looks like a good service (from what we can tell).</li>
</ul>

<p>If you enjoyed this post, you should really check out our upcoming book at <a href="http://www.ng-book.com/">ng-book.com</a>. </p>


          <div class="container" id="signupApp" ng-cloak>
  <div id="topbar_signup_embed">
  Get the weekly email all focused on AngularJS. <b>Sign up below</b> to receive the weekly email and exclusive content.
  <form name="ngSignup" action="http://willcodeforfoo.us6.list-manage1.com/subscribe/post?u=86d6f14c7cc955128485e3b8e&amp;id=fa61364f13" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    
    <div class="row collapse">
      <div class="small-9 columns">
        <input ng-class="{error: ngSignup.email.$dirty && ngSignup.email.$invalid}" type="email" ng-minlength=3 ng-model="ngSignup.email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Email address" required>
      </div>
      <div class="small-3 columns">
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" ng-disabled="ngSignup.$invalid" class="button postfix"></div>
      </div>
        <div class="small-12 columns error" ng-show="ngSignup.EMAIL.$dirty && ngSignup.EMAIL.$invalid">
          <small class="error" ng-show="ngSignup.EMAIL.$error.required">Your email is required.</small>
          <small class="error" ng-show="ngSignup.EMAIL.$error.minlength">Your email is required to be at least 3 characters</small>
          <small class="error" ng-show="ngSignup.EMAIL.$error.email">That is not a valid email. Please input a valid email.</small>
        </div>
      </div>
  </form>
  </div>
</div>

<script type="text/javascript">
  if (typeof(app) == 'undefined') {
    angular.module("signupApp", [])
    .controller("mailChimpValidation", ['$scope', function($scope) {}]);
    var ele = document.getElementById("signupApp");
    angular.element(ele, ['signupApp']);
  }
</script>
          <section id="sample_chapter" ng-app="ngBookApp">    <div class="content">      <h3 class="title">Download a free sample of the ng-book: The Complete Book on AngularJS</h3> <span class="image"><img src="http://www.ng-book.com/images/flatbook-ngbook-small.png" alt="book"></span><div class="desc">It's free, so just enter your email address and the PDF will be sent directly to your inbox.</div>    </div>    <div class="form" ng-init="signedup=false" ng-show="!signuped">      <form action="http://willcodeforfoo.us6.list-manage.com/subscribe/post?u=86d6f14c7cc955128485e3b8e&amp;id=7bbfaae868" method="post" id="mc-embedded-subscribe-form" name="ngBookSignup" class="validate ng-pristine ng-invalid ng-invalid-required" target="_blank" novalidate="">
<div class="mc-field-group">          <input type="email" ng-model="ngBookSignup.email" ng-class="{error: ngBookSignup.email.$dirty &amp;&amp; ngBookSignup.email.$invalid}" value="" name="EMAIL" placeholder="Your email address" class="required email ng-pristine ng-valid ng-valid-email ng-valid-minlength" id="mce-EMAIL" ng-minlength="3">        </div>        <div id="mce-responses" class="clear">          <div class="response" id="mce-error-response" style="display:none"></div>          <div class="response" id="mce-success-response" style="display:none"></div>        </div>        <div class="clear"><input type="submit" value="Send me a free chapter" name="subscribe" id="ngBookSignupSubmit" ng-disabled="ngBookSignup.$invalid" class="button postfix" ng-click="signedup=true" disabled="disabled"></div>      </form>      <div ng-show="signedup" class="ng-hide">      <p>Sweet! We are glad to hear you're interested in learning AngularJS. Enjoy the free chapter. We put a lot of work into building the book series, so we hope you like it!      Talk soon</p>      </div>      <div class="desc">        We won't ever send you spam! You can unsubscribe at any time.      </div>    </div>  </section>

          <footer>
            <ul class="actions">
              <li><a href="/articles"><span class="arrow">←</span> Back to articles</a></li>
              <li><a href="http://twitter.com/home/?status=What you need to know about Angular SEO - http://ng-newsletter.com/posts/serious-angular-seo.html via @ngnewsletter" target="_blank"><img src="/img/twitter-bird-blue-on-white.png" style="width: 56px; height: 26px;" />Share on twitter</a></li>
            </ul>
          </footer>

        </article>

        <section id="comments">
            <h2 class="gamma">Comments</h2>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ngnewsletter'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>

        

        <script type="text/javascript" src="/js/vendor/zepto.js"></script>
<script type="text/javascript" src="/js/vendor/foundation.min.js"></script>

<script src="/js/main.js"></script>

        </div>
    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28176211-3', 'ng-newsletter.com');
  ga('send', 'pageview');

</script>

<script type="text/javascript">
  var $mcGoal = {'settings':{'uuid':'86d6f14c7cc955128485e3b8e','dc':'us6'}};
  (function() {
     var sp = document.createElement('script'); sp.type = 'text/javascript'; sp.async = true; sp.defer = true;
    sp.src = ('https:' == document.location.protocol ? 'https://s3.amazonaws.com/downloads.mailchimp.com' : 'http://downloads.mailchimp.com') + '/js/goal.min.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sp, s);
  })(); 
</script>

</body>
</html>
