<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="width=device-width" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">

<title>Angular Animation - Under the Hood | ng-newsletter</title>

<meta name="author" content="Ari Lerner">
<meta name="description" content="Angular animation -- how it works and how to use it. angularjs angularjs tutorial angular">
<meta name="keywords" content="angularjs angularjs animation animate $animate ngAnimate angular tutorial angularjs tutorial angularjs angularjs tutorial angular realtime firebase angularfire">

<meta name="msvalidate.01" content="BE7DA3BEF0F11153F6E4B5585C12DB20" />
<meta property="og:type" content="website" />
<meta property="og:title" content="ng-newsletter" />
<meta property="og:url" content="http://ng-newsletter.com" />
<meta property="og:image" content="http://ng-newsletter.com/img/" />
<meta property="og:description" content="Angular animation -- how it works and how to use it." />

<meta name="twitter:card" value="summary" />
<meta name="twitter:creator" value="@auser" />
<meta name="twitter:title" value="ng-newsletter" />
<meta name="twitter:description" value="Angular animation -- how it works and how to use it." />
<meta name="twitter:image" value="http://ng-newsletter.com/img/" />

<link rel="alternate" type="application/rss+xml" href="feed.rss" title="Sitewide RSS 2.0 Feed">
<link rel="alternate" type="application/atom+xml" href="atom.xml" title="Sitewide ATOM Feed">
<link rel="alternate" type="application/atom+json" href="atom.json" title="Sitewide JSON Feed">

<link href="/favicon.ico" rel="icon" type="image/ico" />
<link href="/css/site.css" media="screen" rel="stylesheet" type="text/css" /><link href="http://fonts.googleapis.com/css?family=Roboto:400italic,700italic,400,700|Open+Sans:r,i,b,bi|Bitter:r,i,b" media="screen" rel="stylesheet" type="text/css" />
<script src="/js/vendor/custom.modernizr.js"></script>
<script src="/js/vendor/d3.v3.min.js"></script>
<script src="/js/vendor/angular/angular.min.js"></script>
<script src="/js/vendor/angular-route/angular-route.min.js"></script>
<script src="/js/vendor/angular-animate.min.js"></script>
<script src="/js/vendor/angular-translate.min.js"></script>
<script src="/js/vendor/angular-cookies/angular-cookies.min.js"></script>


</head>
<body ng-app="animationDemoApp">

    
    <div id="header">
  <div id="topNav">
    <nav class="top-bar">
      <ul class="title-area">
        <li class="name">
          <h1><a href="/">ng-newsletter</a></h1>
        </li>
        <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
      </ul>

      <section class="top-bar-section">
        <ul class="right">
      		<li><a href="/posts">Articles</a></li>
          <li><a href="/advent2013/">25 days of Angular</a></li>
          <li><a href="/books">Books</a></li>
          <li><a href="/sponsor">Sponsorship</a></li>
        </ul>
      </section>
    </nav>
  </div>
  <div class="headerContent">
  </div>
</div>

    <div class="container">
      <div id="article">
        <article class="post">
          <header>
            <h1 class="mega">Angular Animation - Under the Hood</h1>
          </header>
          
          <blockquote>
<p>In this article, we aim to show you how animation works inside of AngularJS rather than demonstrate the breadth of <code>ngAnimate</code>&rsquo;s functionality. </p>
</blockquote>

<p>The latest version of Angular (1.2.0 and beyond) now includes support for animations in our already feature-packed framework. </p>

<p>With animation built into the framework, it&rsquo;s simple to integrate fluid animations into our applications in a simple, nonintrusive manner.</p>

<p>The Angular team created the <code>ngAnimate</code> module to give our Angular apps hooks into providing CSS and JavaScript. </p>

<p>There are several ways to make animations in an Angular app:</p>

<ul>
<li>Using CSS3 Transitions</li>
<li>Using CSS3 Animations</li>
<li>Using JavaScript animations</li>
</ul>

<h2>Installation</h2>

<p>Since 1.2.0.rc1, animations have been pulled out of the core of Angular into their own module. In order to include animations in our Angular app, we&rsquo;ll therefore need to install and reference that module in our app.</p>

<p>We can download it from <a href="http://code.angularjs.org/">code.angularjs.org</a> and save it in a place that we can reference from our HTML, like <code>js/vendor/angular-animate.js</code>. </p>

<p>We can also install it using <a href="#bower">Bower</a>, which will place it in our usual Bower directory. For more information about Bower, see the <a href="#bower">Bower chapter</a>.</p>
<pre class="highlight shell"><span class="gp">$ </span>bower install --save angular-animate
</pre>
<p>We&rsquo;ll need to reference this library in our HTML <em>after</em> we reference Angular itself. </p>
<pre class="highlight html"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/vendor/angular.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/vendor/angular-animate.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</pre>
<p>Lastly, we&rsquo;ll need to reference the <code>ngAnimate</code> module as a dependency in our app module:</p>
<pre class="highlight javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ngAnimate'</span><span class="p">]);</span>
</pre>
<p>Now we are ready to take on animations with AngularJS.</p>

<h2>How it works</h2>

<p>The <code>$animate</code> service itself, by default, applies two CSS classes to the animated element for each animation event (see below). </p>

<p>The <code>$animate</code> service supports several built-in Angular directives that automatically support animation without the need for any extra configuration. It is also flexible enough to enable us to build our own animations for our directives.</p>

<p>All of the pre-existing directives that support animation do so through monitoring events provided on the directives. </p>

<p>For instance, when a new <code>ngView</code> <em>enters</em> and brings new content into the browser, this event is called the <em>enter</em> event for <code>ngView</code>. When <code>ng-hide</code> is ready to show an element, the <code>remove</code> event is fired.</p>

<p>The following is a list of directives and the events that they each fire at different states. We will use these events to define how our animations will work in each state.</p>

<table class="description_table"><thead>
<tr>
<th>Directive</th>
<th>Events</th>
</tr>
</thead><tbody>
<tr>
<td>ngRepeat</td>
<td>enter, leave, move</td>
</tr>
<tr>
<td>ngView</td>
<td>enter, leave</td>
</tr>
<tr>
<td>ngInclude</td>
<td>enter, leave</td>
</tr>
<tr>
<td>ngSwitch</td>
<td>enter, leave</td>
</tr>
<tr>
<td>ngIf</td>
<td>enter, leave</td>
</tr>
<tr>
<td>ngClass</td>
<td>add, remove</td>
</tr>
<tr>
<td>ngShow</td>
<td>add, remove</td>
</tr>
<tr>
<td>ngHide</td>
<td>add, remove</td>
</tr>
</tbody></table>

<h2>Using CSS3 Transitions</h2>

<p>Using CSS3 Transitions is by far the easiest way to include animations in our app, and it will work for all browsers except IE9 and earlier versions. </p>

<blockquote>
<p>Browsers that do not support CSS3 Transitions will gracefully fall back to the non-animated version of the app.</p>
</blockquote>

<p>To do <strong>any</strong> CSS animation, we&rsquo;ll need to make sure we include the classes we&rsquo;ll be working with to the DOM element we&rsquo;re interested in animating. </p>

<p>For instance, in the following demo we&rsquo;ll animate the following element:</p>
<pre class="highlight html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;fadein&quot;</span><span class="nt">&gt;&lt;h2&gt;</span>Hello<span class="nt">&lt;/h2&gt;&lt;/div&gt;</span>
</pre>
<p>CSS3 Transitions are fully class-based, which means that as long as we have classes that define the animation in our HTML the animation will be animated in the browser.</p>

<p>In order for us to achieve animations with classes, we&rsquo;ll need to follow the Angular CSS naming conventions to define our CSS transitions.</p>

<p>CSS transitions are effects that let an element gradually change from one style to another style. To define an animation, we must specify the property we want to add an animation to as well as specify the duration of effect.</p>

<p>For instance, this code will add a transition effect on all of the properties on DOM elements with the <code>.fadein</code> class for a two-second duration. </p>
<pre class="highlight css"><span class="nc">.fadein</span> <span class="p">{</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="m">2s</span> <span class="n">linear</span> <span class="n">all</span><span class="p">;</span>
  <span class="nl">-webkit-transition</span><span class="p">:</span> <span class="m">2s</span> <span class="n">linear</span> <span class="n">all</span><span class="p">;</span>
  <span class="nl">-moz-transition</span><span class="p">:</span> <span class="m">2s</span> <span class="n">linear</span> <span class="n">all</span><span class="p">;</span>
  <span class="nl">-o-transition</span><span class="p">:</span> <span class="m">2s</span> <span class="n">linear</span> <span class="n">all</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>With this transition and timing set, we can define properties on different states of the DOM element.</p>
<pre class="highlight css"><span class="nc">.fadein</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="nl">width</span><span class="p">:</span> <span class="m">300px</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="m">300px</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>With <code>ngAnimate</code>, Angular starts our directive animations by adding two classes to each animation event: the initial <code>ng-[EVENT]</code> class and, shortly thereafter, the <code>ng-[EVENT]-active</code> class. </p>

<p>The <code>ng-[EVENT]</code> CSS class represents the initial state of the animation, while the <code>ng-[EVENT]-active</code> CSS class is there so we can define the final state of the animation.</p>

<p>To automatically allow the DOM elements from above to transition with Angular animation, we&rsquo;ll modify the initial <code>.fadein</code> example to include the initial state class:</p>
<pre class="highlight css"><span class="nc">.fadein.ng-enter</span> <span class="p">{</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.fadein.ng-enter.ng-enter-active</span> <span class="p">{</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>To actually <em>run</em> the animation, we&rsquo;ll need to include the CSS animation definition. In this definition, we need to include <strong>both</strong> the duration and the element attributes that we&rsquo;re going to modify:</p>
<pre class="highlight css"><span class="nc">.fadein.ng-enter</span> <span class="p">{</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="m">1s</span> <span class="n">linear</span> <span class="n">all</span><span class="p">;</span>
  <span class="nl">-webkit-transition</span><span class="p">:</span> <span class="m">1s</span> <span class="n">linear</span> <span class="n">all</span><span class="p">;</span>
  <span class="nl">-moz-transition</span><span class="p">:</span> <span class="m">1s</span> <span class="n">linear</span> <span class="n">all</span><span class="p">;</span>
  <span class="nl">-o-transition</span><span class="p">:</span> <span class="m">1s</span> <span class="n">linear</span> <span class="n">all</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<blockquote>
<p>In this example, we set the element attributes we&rsquo;re going to modify as <code>all</code>. In doing so, we are telling CSS that we are going to change all of the properties in the new CSS class. If we want to change only a particular property, we can list it above, instead of using <code>all</code>.</p>
</blockquote>

<p>Using the <code>ng-if</code> directive, this modification looks like:</p>
<pre class="highlight html"><span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;MyController&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">ng-click=</span><span class="s">&quot;showHello()&quot;</span><span class="nt">&gt;</span>Show hello<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">ng-if=</span><span class="s">&quot;shouldShowHello&quot;</span> <span class="na">class=</span><span class="s">&quot;fadein&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Hello<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">ng-click=</span><span class="s">&quot;reset()&quot;</span><span class="nt">&gt;</span>Reset<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
<h4>See it</h4>

<div ng-controller="Demo1Ctrl">
  <button ng-if="!shouldShowHello" class="fadein1" ng-click="showHello()">Show hello</button>
  <div ng-if="shouldShowHello" src="helloTpl.html" class="fadein1">
    <h2>Hello</h2>
    <button ng-click="reset()">Reset</button>
  </div>
</div>

<h2>Using CSS3 Animations</h2>

<p>CSS3 animations are more extensive and more complex than CSS3 transitions. They are supported by all major browsers except IE9 and earlier versions of IE. With CSS3 animations, we&rsquo;ll use the same initial class <code>ng-[EVENT]</code>, but we don&rsquo;t need to define animation states in the <code>ng-[EVENT]-active</code> state, because our CSS rules will handle the rest of the block.</p>

<p>We create the animation in the CSS3 <code>@keyframes</code> rule. Within the CSS element where we define the <code>@keyframes</code> rule, we&rsquo;ll define the CSS styles that we want to be manipulated. </p>

<p>When we want to animate the DOM element, we&rsquo;ll use the <code>animation:</code> property to bind the <code>@keyframe</code> CSS property, which applies the animation to the CSS element. </p>

<blockquote>
<p>We&rsquo;ll need to specify both the name of the animation as well as the duration when we do so. </p>

<p><strong>Remember to add the animation duration</strong>: If we forget to add the duration of the animation, the duration will default to 0, and the animation will not run.</p>
</blockquote>

<p>To create our <code>@keyframes</code> rule, we&rsquo;ll need to give our keyframe a name and set the time periods for where the properties should be throughout the animation.</p>
<pre class="highlight css"><span class="k">@keyframes</span> <span class="n">firstAnimation</span> <span class="p">{</span>
  <span class="nt">0</span><span class="o">%</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">yellow</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nt">100</span><span class="o">%</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">black</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c">/* For Chrome and Safari */</span>
<span class="k">@-webkit-keyframes</span> <span class="n">firstAnimation</span> <span class="p">{</span>
  <span class="c">/* from is equivalent to 0% */</span>
  <span class="nt">from</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">yellow</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c">/* from is equivalent to 100% */</span>
  <span class="nt">to</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="no">black</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
<blockquote>
<p>Using the keyword <code>from</code> is equivalent to setting the percentage to <code>0%</code>. Using the keyword <code>to</code> is equivalent to setting the percentage to <code>100%</code>.</p>
</blockquote>

<p>We are not limited to <code>0%</code> and <code>100%</code>; we can provide animations in steps, such as at <code>10%</code>, <code>15%</code>, etc.</p>

<p>To assign this <code>@keyframe</code> property to the classes we want to animate, we&rsquo;ll use the <code>animation</code> property, which will apply the animation to the elements targeted by that CSS selector.</p>
<pre class="highlight css"><span class="nc">.fadein</span><span class="nd">:hover</span> <span class="p">{</span>
  <span class="nl">-webkit-animation</span><span class="p">:</span> <span class="m">2s</span> <span class="n">firstAnimation</span><span class="p">;</span>
  <span class="nl">animation</span><span class="p">:</span> <span class="m">2s</span> <span class="n">firstAnimation</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>With <code>ngAnimate</code>, we&rsquo;ll bind the <code>firstAnimation</code> value to any elements that are targeted with the <code>.fadein</code> class. Angular will apply and remove the <code>.ng-enter</code> class for us automatically, so we can simply attach our event to the <code>.fadein.ng-enter</code> class:</p>
<pre class="highlight css"><span class="nc">.fadein.ng-enter</span> <span class="p">{</span>
  <span class="nl">-moz-animation</span><span class="p">:</span> <span class="m">2s</span> <span class="n">firstAnimation</span><span class="p">;</span>
  <span class="nl">-o-animation</span><span class="p">:</span> <span class="m">2s</span> <span class="n">firstAnimation</span><span class="p">;</span>
  <span class="nl">-webkit-animation</span><span class="p">:</span> <span class="m">2s</span> <span class="n">firstAnimation</span><span class="p">;</span>
  <span class="nl">animation</span><span class="p">:</span> <span class="m">2s</span> <span class="n">firstAnimation</span><span class="p">;</span>
<span class="p">}</span>
</pre>
<p>For the <code>ng-show</code> directive, we can use the <code>ng-add</code> event to show the animation in the DOM. </p>
<pre class="highlight html"><span class="nt">&lt;div</span> <span class="na">ng-init=</span><span class="s">&quot;show=false&quot;</span> 
    <span class="na">ng-controller=</span><span class="s">&quot;HomeCtrl&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">ng-click=</span><span class="s">&quot;show=!show&quot;</span><span class="nt">&gt;</span>Show<span class="nt">&lt;/button&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">ng-show=</span><span class="s">&quot;show&quot;</span> <span class="na">class=</span><span class="s">&quot;animateMe&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h2&gt;</span>Show me<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
<h4>See it</h4>

<div ng-init="show=false" 
    ng-controller="Demo1Ctrl">
  <div ng-hide="show" class="animateMe">
    <button ng-click="show=!show">Reveal</button>
  </div>
  <div ng-hide="!show" class="animateMe">
    <button ng-click="show=!show">Hide</button>
    <h2>I&rsquo;m shown</h2>
  </div>
</div>

<h2>Using JavaScript animations</h2>

<p>JavaScript animation is different than the previous two Angular animation methods in that we&rsquo;ll set properties on the DOM element directly using JavaScript. </p>

<p>JavaScript animation is supported in all major browsers that enable JavaScript, so it&rsquo;s a good choice if we want to offer animations on browsers that don&rsquo;t support CSS transitions and animations.</p>

<p>Instead of manipulating our CSS to animate elements, we&rsquo;ll update our JavaScript to handle running animations for us.</p>

<p>The <code>ngAnimate</code> module adds the <code>.animation</code> method to the module API; this method presents an interface on which we can build our animations. </p>

<p>The <code>animation()</code> method takes two parameters:</p>

<ul>
<li>classname (string)</li>
</ul>

<p>This classname will match the class of the element to animate. For our examples thus far, the animation should be named: <code>.fadein</code>.</p>

<ul>
<li>animateFun (function)</li>
</ul>

<p>The animate function is expected to return an object that includes functions for the different events that the directive fires (where it&rsquo;s used). </p>

<p>See the <a href="http://docs.angularjs.org/api/ngAnimate">$animate API</a> docs for detailed documentation on these functions.</p>
<pre class="highlight javascript"><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'ngAnimate'</span><span class="p">])</span>
<span class="p">.</span><span class="nx">animation</span><span class="p">(</span><span class="s1">'.fadein'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">enter</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Run animation
</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cancelled</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Cancel animation
</span>      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p>The $angular service will call these functions for the element specified. Inside these functions, we are free to do what we will with the element. The only requirement is that we call the callback function <code>done()</code> when we are done with the animation. </p>

<p>Inside these functions, we can return an <code>end</code> function that will be called when the animation is complete OR the animation has been canceled. </p>

<p>When the animation is triggered, <code>$animate</code> will look for the matching animation function for the event. If it finds a function that matches the event, it will execute it. </p>

<h2>Example time</h2>

<p>We&rsquo;re going to create our animation using the JavaScript API:</p>

<h4>See it</h4>

<div ng-controller="Demo1Ctrl">
  <div square-scroller>
  </div>
</div>

<p>This example is set up using this HTML:</p>
<pre class="highlight html"><span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;DemoCtrl&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">square-scroller</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre>
<p>We&rsquo;re not declaring any classes, only setting up a directive. The directive (shortened so we can keep this section brief) sets up a template that includes the images and sets the animation class that we&rsquo;ll define. </p>

<p>Lastly, it stores the current offsetTop for the element in a data attribute (i.e., data-offsetTop=&ldquo;&rdquo; in the HTML):</p>
<pre class="highlight javascript"><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">'squareScroller'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$animate</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">clicked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="na">scope</span><span class="p">:</span> <span class="p">{},</span>
      <span class="na">template</span><span class="p">:</span> <span class="s1">'&lt;div ng-init=&quot;runAnimation=false&quot;&gt;\
          &lt;div ng-hide=&quot;!runAnimation&quot; class=&quot;square-scroll&quot;&gt;\
            &lt;img src=&quot;/images/animation/one.png&quot; /&gt;\
            &lt;img src=&quot;/images/animation/two.png&quot; /&gt;\
            &lt;img src=&quot;/images/animation/three.png&quot; /&gt;\
          &lt;/div&gt;\
        &lt;/div&gt;'</span><span class="p">,</span>
      <span class="na">link</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">scope</span><span class="p">,</span> <span class="nx">ele</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">,</span> <span class="nx">ctrl</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">ele</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">),</span> 
            <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">offsetTop</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span><span class="p">;</span>
              <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'data-offsetTop'</span><span class="p">,</span> <span class="nx">offsetTop</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
</pre>
<p>This directive doesn&rsquo;t do any of the animation on its own; rather, it only sets up the template. The <em>real</em> magic of animations happen with the <code>.square-scroll</code> animation.</p>

<p>Using the <code>.animation</code> API, we&rsquo;ll create our animation:</p>
<pre class="highlight javascript"><span class="p">.</span><span class="nx">animation</span><span class="p">(</span><span class="s1">'.square-scroll'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">removeClass</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ele</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">className</span> <span class="o">===</span> <span class="s1">'ng-hide'</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// We're unhiding the element
</span>        <span class="c1">// i.e. showing the element
</span>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nx">done</span><span class="p">();</span> <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">addClass</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ele</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">className</span> <span class="o">===</span> <span class="s1">'ng-hide'</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// We're hiding the element
</span>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="nx">done</span><span class="p">();</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
<p>This function sets up the <code>.square-scroll</code> CSS to handle <em>two</em> animation events: the <code>addClass</code> and <code>removeClass</code> events. We&rsquo;re using these events because we&rsquo;re using the <code>ng-hide</code> directive to show or hide our elements, which effectively just adds the <code>ng-hide</code> class on the elements.</p>

<p>When the <code>ng-hide</code> directive is ready to show an element, it will fire the <code>removeClass</code> function (it&rsquo;s removing the <code>ng-hide</code> CSS class). When it&rsquo;s going to hide the element, it will add the <code>ng-hide</code> CSS class to the element.</p>

<p>Our <code>.animation</code> handles this animation above by checking for the <code>className</code> that is being added or removed and making sure we <em>only</em> add animations if we&rsquo;re showing or hiding the element.</p>

<p>The full source of the directive can be found <a href="http://d.pr/vzTG">here</a>.</p>

<script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.10.3/TweenMax.min.js"></script>

<script src="/js/vendor/jquery.js"></script>

<script src="/js/vendor/skrollr.min.js"></script>

<style type="text/css">
  .fadein1.ng-enter {
    opacity: 0;
  }
  .fadein1.ng-enter.ng-enter-active {
    opacity: 1;
  }
  .fadein1.ng-leave.ng-leave-active {
    opacity: 0;
  }
  .fadein1.ng-enter,
  .fadein1.ng-leave {
    transition: 1s linear all;
    -webkit-transition: 1s linear all;
    -moz-transition: 1s linear all;
    -o-transition: 1s linear all;
  }

    @keyframes animateMe-add {
      from {opacity: 1;}
      to {opacity: 0;}
    }
    @-webkit-keyframes animateMe-add {
      from {opacity: 1;}
      to {opacity: 0;}
    }
    @keyframes animateMe-remove {
      from {opacity:0;}
      to {opacity:1;}
    }
    @-webkit-keyframes animateMe-remove {
      from {opacity:0;}
      to {opacity:1;}
    }

  .animateMe.ng-hide-add {
    -webkit-animation: 2s animateMe-add;
    -moz-animation: 2s animateMe-add;
    -o-animation: 2s animateMe-add;
    animation: 2s animateMe-add;
  }
  .animateMe.ng-hide-remove {
    -webkit-animation: 2s animateMe-remove;
    -moz-animation: 2s animateMe-remove;
    -o-animation: 2s animateMe-remove;
    animation: 2s animateMe-remove;
    display: block !important;
  }

  @-webkit-keyframes slideInDown {
    0% {
      opacity: 0;
      -webkit-transform: translateY(-2000px);
    }

    100% {
      -webkit-transform: translateY(0);
    }
  }

  @-moz-keyframes slideInDown {
    0% {
      opacity: 0;
      -moz-transform: translateY(-2000px);
    }

    100% {
      -moz-transform: translateY(0);
    }
  }

  @-o-keyframes slideInDown {
    0% {
      opacity: 0;
      -o-transform: translateY(-2000px);
    }

    100% {
      -o-transform: translateY(0);
    }
  }

  @keyframes slideInDown {
    0% {
      opacity: 0;
      transform: translateY(-2000px);
    }

    100% {
      transform: translateY(0);
    }
  }

  .slideInDown {
    -webkit-animation: 0.25s slideInDown;
    -moz-animation: 0.25s slideInDown;
    -o-animation: 0.25s slideInDown;
    animation: 0.25s slideInDown;
  }
</style>

<script type="text/javascript">
  angular.module('animationDemoApp', ['ngAnimate'])
  .controller('Demo1Ctrl', function($scope) {
    $scope.showHello = function() {
      $scope.shouldShowHello = true;
    }
    $scope.reset = function() {
      $scope.shouldShowHello = false;
    }
    $scope.run = function() {
    }
  })
  .directive('squareScroller', function($animate) {
    var clicked = false;
    return {
      scope: {},
      template: '<div ng-init="runAnimation=false">\
          <div ng-hide="runAnimation">\
          <button ng-click="runAnimation=!runAnimation">Run animation</button>\
          </div>\
          <div ng-hide="!runAnimation" class="square-scroll">\
          <button ng-click="runAnimation=!runAnimation">Stop animation</button>\
          <span>Try scrolling</span>\
            <img src="/images/animation/one.png" />\
            <img src="/images/animation/two.png" />\
            <img src="/images/animation/three.png" />\
          </div>\
        </div>',
      link: function(scope, ele, attrs, ctrl) {
        angular.forEach(ele.find("img"), 
            function(e, idx) {
              var offsetTop = $(e).offset().top;
              $(e).css('position', 'fixed');
              $(e).css('bottom', '10px');
              $(e).css('left', 10 + idx * 20 + 'px');
              $(e).css('width', '120px');
              $(e).css('z-index', '1000');

              $(e).attr('data-offsetTop', offsetTop);
              $(e).addClass('slideInDown');
        });
      }
    }
  })
  .animation('.square-scroll', function() {
    var sk;

    return {
      // Showing
      removeClass: function(ele, className, done) {
        if (className === 'ng-hide') {
          sk = skrollr.init({
            render: function(data) {
              angular.forEach(ele.find("img"), 
                function(e, i) {
                  var ot = $(e).attr('data-offsetTop');
                  var newX = 
                    Math.abs(data.curTop - ot) + 
                      (i * 80);
                  if (Math.floor(newX % 4) == 0) {
                    var newY = 
                      (Math.sin(newX) * 20) + 10;
                    $(e).css('bottom', newY + 'px');
                  }
              });
            }
          });
          done();
        } else {
          done();
        }
      },
      // Hiding the class
      addClass: function(ele, className, done) {
        if (className === 'ng-hide') {
          // Cleaning up
          sk.destroy();
          done();
        } else {
          done();
        }
      }
    }
  });
</script>


          <div class="container" id="signupApp" ng-cloak>
  <div id="topbar_signup_embed">
  Get the weekly email all focused on AngularJS. <b>Sign up below</b> to receive the weekly email and exclusive content.
  <form name="ngSignup" action="http://willcodeforfoo.us6.list-manage1.com/subscribe/post?u=86d6f14c7cc955128485e3b8e&amp;id=fa61364f13" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    
    <div class="row collapse">
      <div class="small-9 columns">
        <input ng-class="{error: ngSignup.email.$dirty && ngSignup.email.$invalid}" type="email" ng-minlength=3 ng-model="ngSignup.email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Email address" required>
      </div>
      <div class="small-3 columns">
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" ng-disabled="ngSignup.$invalid" class="button postfix"></div>
      </div>
        <div class="small-12 columns error" ng-show="ngSignup.EMAIL.$dirty && ngSignup.EMAIL.$invalid">
          <small class="error" ng-show="ngSignup.EMAIL.$error.required">Your email is required.</small>
          <small class="error" ng-show="ngSignup.EMAIL.$error.minlength">Your email is required to be at least 3 characters</small>
          <small class="error" ng-show="ngSignup.EMAIL.$error.email">That is not a valid email. Please input a valid email.</small>
        </div>
      </div>
  </form>
  </div>
</div>

<script type="text/javascript">
  if (typeof(app) == 'undefined') {
    angular.module("signupApp", [])
    .controller("mailChimpValidation", ['$scope', function($scope) {}]);
    var ele = document.getElementById("signupApp");
    angular.element(ele, ['signupApp']);
  }
</script>
          <section id="sample_chapter" ng-app="ngBookApp">    <div class="content">      <h3 class="title">Download a free sample of the ng-book: The Complete Book on AngularJS</h3> <span class="image"><img src="http://www.ng-book.com/images/flatbook-ngbook-small.png" alt="book"></span><div class="desc">It's free, so just enter your email address and the PDF will be sent directly to your inbox.</div>    </div>    <div class="form" ng-init="signedup=false" ng-show="!signuped">      <form action="http://willcodeforfoo.us6.list-manage.com/subscribe/post?u=86d6f14c7cc955128485e3b8e&amp;id=7bbfaae868" method="post" id="mc-embedded-subscribe-form" name="ngBookSignup" class="validate ng-pristine ng-invalid ng-invalid-required" target="_blank" novalidate="">
<div class="mc-field-group">          <input type="email" ng-model="ngBookSignup.email" ng-class="{error: ngBookSignup.email.$dirty &amp;&amp; ngBookSignup.email.$invalid}" value="" name="EMAIL" placeholder="Your email address" class="required email ng-pristine ng-valid ng-valid-email ng-valid-minlength" id="mce-EMAIL" ng-minlength="3">        </div>        <div id="mce-responses" class="clear">          <div class="response" id="mce-error-response" style="display:none"></div>          <div class="response" id="mce-success-response" style="display:none"></div>        </div>        <div class="clear"><input type="submit" value="Send me a free chapter" name="subscribe" id="ngBookSignupSubmit" ng-disabled="ngBookSignup.$invalid" class="button postfix" ng-click="signedup=true" disabled="disabled"></div>      </form>      <div ng-show="signedup" class="ng-hide">      <p>Sweet! We are glad to hear you're interested in learning AngularJS. Enjoy the free chapter. We put a lot of work into building the book series, so we hope you like it!      Talk soon</p>      </div>      <div class="desc">        We won't ever send you spam! You can unsubscribe at any time.      </div>    </div>  </section>

          <footer>
            <ul class="actions">
              <li><a href="/articles"><span class="arrow">←</span> Back to articles</a></li>
              <li><a href="http://twitter.com/home/?status=Angular Animation - Under the Hood - http://ng-newsletter.com/posts/angular-animation.html via @ngnewsletter" target="_blank"><img src="/img/twitter-bird-blue-on-white.png" style="width: 56px; height: 26px;" />Share on twitter</a></li>
            </ul>
          </footer>

        </article>

        <section id="comments">
            <h2 class="gamma">Comments</h2>
            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ngnewsletter'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>

        

        <script type="text/javascript" src="/js/vendor/zepto.js"></script>
<script type="text/javascript" src="/js/vendor/foundation.min.js"></script>

<script src="/js/main.js"></script>

        </div>
    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-28176211-3', 'ng-newsletter.com');
  ga('send', 'pageview');

</script>

<script type="text/javascript">
  var $mcGoal = {'settings':{'uuid':'86d6f14c7cc955128485e3b8e','dc':'us6'}};
  (function() {
     var sp = document.createElement('script'); sp.type = 'text/javascript'; sp.async = true; sp.defer = true;
    sp.src = ('https:' == document.location.protocol ? 'https://s3.amazonaws.com/downloads.mailchimp.com' : 'http://downloads.mailchimp.com') + '/js/goal.min.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(sp, s);
  })(); 
</script>

</body>
</html>
