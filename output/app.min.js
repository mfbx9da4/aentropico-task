/*! blog 2014-02-10 */
function buildChartFromReportId(a,b){a.get("/reports/"+b).success(function(a){var b=d3.custom.charts.lineChart().width($("#graph").width()).height($("#graph").width()/2).x(function(a){return+a.x}).y(function(a){return+a.y});b("#graph",a.data)})}function buildBarChart(a,b){a.get("/reports/"+b).success(function(a){var b=d3.custom.charts.barChart().width($("#figure").width()).height($("#figure").width()/2).x(function(a){return+a.x}).y(function(a){return+a.y}),c=d3.csv.parse(a.data);d3.select("#figure").datum(c).call(b)})}function AWS(){var a=function(a){console.log("res"),console.log(a),$("#fld_redirect").val(a.S3Redirect),$("#fld_AWSAccessKeyId").val(a.s3Key),$("#fld_Policy").val(a.s3PolicyBase64),$("#fld_Signature").val(a.s3Signature),$("#myform").submit()};this.requestCredentials=function(b){var c;c=b.replace(/.+[\\\/]/,""),$.ajax({url:"/gets3credentials/"+c,dataType:"JSONP",success:a,error:function(a,b,c){console.log("here"),console.log(a),console.log(b),console.log(c)}})}}d3.custom={charts:{}},d3.custom.charts.lineChart=function(){function a(a,m){b=d3.select(a).append("svg").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")");var n=d3.csv.parse(m);h.range([0,d-c.left-c.right]).domain(d3.extent(n,f)),i.range([e-c.top-c.bottom,0]).domain(d3.extent(n,g)),b.append("g").attr("class","x axis").attr("transform","translate(0,"+(e-c.top-c.bottom)+")").call(j),b.append("g").attr("class","y axis").call(k).append("text").attr("transform","rotate(-90)"),b.append("path").datum(n).attr("class","line").attr("d",l)}var b,c={top:20,right:20,bottom:30,left:50},d=760-c.left-c.right,e=120-c.top-c.bottom,f=function(a){return a[0]},g=function(a){return a[1]},h=d3.scale.linear(),i=d3.scale.linear(),j=d3.svg.axis().scale(h).orient("bottom"),k=d3.svg.axis().scale(i).orient("left"),l=d3.svg.line().x(function(a){return h(a.x)}).y(function(a){return i(a.y)});return a.margin=function(b){return arguments.length?(c=b,a):c},a.width=function(b){return arguments.length?(d=b,a):d},a.height=function(b){return arguments.length?(e=b,a):e},a.x=function(b){return arguments.length?(f=b,a):f},a.y=function(b){return arguments.length?(g=b,a):g},a},d3.custom.charts.barChart=function(){function a(a){a.each(function(a){var g=d-c.left-c.right,i=e-c.top-c.bottom;console.log(a);var j=d3.scale.ordinal().domain(a.map(function(a,b){return+b})).rangeRoundBands([0,g],.1),k=d3.scale.linear().domain([0,d3.max(a,function(a){return+h(a)})]).range([i,0]),l=d3.svg.axis().scale(j).orient("bottom"),m=d3.svg.axis().scale(k).orient("left"),n=g/a.length;if(!b){b=d3.select(this).append("svg").classed("chart",!0);var o=b.append("g").classed("container-group",!0);o.append("g").classed("chart-group",!0),o.append("g").classed("x-axis-group axis",!0),o.append("g").classed("y-axis-group axis",!0)}b.select(".container-group").attr({transform:"translate("+c.left+","+c.top+")"}),b.select(".x-axis-group.axis").attr({transform:"translate(0,"+i+")"}).call(l),b.select(".y-axis-group.axis").call(m);var p=j.rangeBand()/100*f;n=j.rangeBand()-p;var q=b.select(".chart-group").selectAll(".bar").data(a);q.enter().append("rect").classed("bar",!0).attr({x:g,width:n,y:function(a){return k(h(a))},height:function(a){return i-k(h(a))}}),q.transition().attr({width:n,x:function(a,b){return j(b)+p/2},y:function(a){return k(h(a))},height:function(a){return i-k(h(a))}}),q.exit().transition().style({opacity:0}).remove()})}var b,c={top:20,right:20,bottom:40,left:40},d=500,e=500,f=0,g=function(a){return a[0]},h=function(a){return a[1]};return a.width=function(a){return arguments.length?(d=parseInt(a),this):d},a.height=function(a){return arguments.length?(e=parseInt(a),this):e},a.gap=function(a){return arguments.length?(f=a,this):f},a.x=function(b){return arguments.length?(g=b,a):g},a.y=function(b){return arguments.length?(h=b,a):h},a};var AentropicoApp=angular.module("AentropicoApp",["angularFileUpload","ngRoute"]);AentropicoApp.config(function(a){a.when("/about",{templateUrl:"../README.html",controller:"aboutController"}).when("/reports/:reportId",{templateUrl:"../html/upload.html",controller:"uploadController"}).when("/reports",{templateUrl:"../html/upload.html",controller:"uploadController"}).otherwise({redirectTo:"/reports"})}),AentropicoApp.controller("uploadController",["$scope","$http","$upload","$location","$routeParams",function(a,b,c,d,e){buildBarChart(b,e.reportId),$("input[type=file]").focus(),e.reportId&&($("#percent-complete").width("100%"),buildChartFromReportId(b,e.reportId)),a.onFileSelect=function(b){var e=$("#percent-complete");e.width("0%").parent().show();var f=b[0];console.log(f),a.upload=c.upload({url:"/csv",method:"POST",file:f}).then(function(a){if(!a.data.success)throw a.data.message;d.path("reports/"+a.data.reportId)},null,function(a){e.width(parseInt(100*a.loaded/a.total)+"%")})}}]),AentropicoApp.controller("aboutController",["$scope",function(){}]),window.aws=new AWS;